# マスターデータ自動セットアップガイド（実績 & ショップ）

**対象**: チームメンバー全員  
**所要時間**: 約1分  
**最終更新**: 2026年2月6日 21:10

---

## 📋 概要

このシステムには以下のマスターデータが必要です：
- ✅ **実績データ**: 45件（トロフィー機能）
- ✅ **アクセサリーデータ**: 48件（ショップ機能）

**✅ このガイドに従えば、すべて自動的に作成されます！**

---

## 🚀 セットアップ手順（全メンバー共通）

### Step 1: 最新コードを取得

```bash
git pull origin main
```

### Step 2: マイグレーション実行（自動作成）

```bash
cd codemon/appproject
python manage.py migrate
```

**実行結果の例**:
```
Applying codemon.0010_auto_create_achievements...🚀 実績データを自動作成します...
✅ 実績データ 45 件を作成しました！
 OK
Applying codemon.0011_auto_create_accessories...🔧 アクセサリーマスターデータを作成中...
✅ アクセサリーマスターデータを48件作成しました
   - 花: 8種類
   - 眼鏡: 8種類
   - リボン: 8種類
   - 星: 8種類
   - 帽子: 8種類
   - 王冠: 8種類
 OK
```

### Step 3: 確認（オプション）

```bash
# 実績データ確認
python check_achievements_data.py

# アクセサリーデータ確認
python check_accessories.py
```

**期待される出力（実績）**:
```
=== 実績データ確認 ===
総実績数: 45

[system]: 5件
[algorithm]: 5件
[login]: 5件
（以下省略）
```

**期待される出力（アクセサリー）**:
```
==================================================
アクセサリーマスターデータ確認
==================================================

✅ アクセサリー総数: 48件

【カテゴリー別】
  - crown: 8件
  - flower: 8件
  - glasses: 8件
  - hat: 8件
  - ribbon: 8件
  - star: 8件
```

---

## ✨ それだけです！

**マイグレーション実行で以下が自動的に作成されます：**
- ✅ 実績データ 45件
- ✅ アクセサリーデータ 48件

手動でスクリプトを実行する必要は**ありません**。

---

## 🎮 動作確認

### 1. 実績システム（トロフィー機能）

1. 開発サーバー起動
   ```bash
   python manage.py runserver
   ```

2. ブラウザでアクセス
   ```
   http://127.0.0.1:8000/codemon/achievements/
   ```

3. **期待される表示**:
   - 9カテゴリの実績カード（各5枚）= 45枚
   - ランク別の色分け（ブロンズ/シルバー/ゴールド/プラチナ/ダイヤ）
   - 進捗バー
   - 「ホームへ」ボタン

### 2. ショップシステム（アクセサリー機能）

1. ブラウザでアクセス
   ```
   http://127.0.0.1:8000/codemon/accessories/
   ```

2. **期待される表示**:
   - 6カテゴリのアクセサリーカード（各8枚）= 48枚
   - カテゴリ別タブ（花、眼鏡、リボン、星、帽子、王冠）
   - 各アクセサリーの画像とプレビュー
   - 価格表示（100コイン）

---

## 🔧 仕組み

### 自動作成マイグレーション

#### 1. 実績データ（0010_auto_create_achievements.py）

ファイル: `codemon/migrations/0010_auto_create_achievements.py`

```python
def create_achievements(apps, schema_editor):
    """実績データを自動作成（既存データがある場合はスキップ）"""
    Achievement = apps.get_model('codemon', 'Achievement')
    
    if Achievement.objects.exists():
        print("✅ 実績データは既に存在します。スキップします。")
        return
    
    # 45件の実績を作成...
```

#### 2. アクセサリーデータ（0011_auto_create_accessories.py）

ファイル: `codemon/migrations/0011_auto_create_accessories.py`

```python
def create_accessories(apps, schema_editor):
    """アクセサリーマスターデータを作成"""
    Accessory = apps.get_model('codemon', 'Accessory')
    
    if Accessory.objects.exists():
        print("✅ アクセサリーデータは既に存在します。スキップします。")
        return
    
    # 48件のアクセサリーを作成...
```
    
    # 既に実績データが存在する場合はスキップ
    if Achievement.objects.exists():
        print("✅ 実績データは既に存在します。スキップします。")
        return
    
    # 45件の実績データを作成
    # ...
```

**特徴**:
- ✅ `python manage.py migrate` で自動実行
- ✅ 既にデータがある場合はスキップ
- ✅ ロールバック対応（必要に応じてデータ削除可能）

---

## 📊 作成される実績データ

### カテゴリ一覧（全9種類、各5段階）

| カテゴリ | アイコン | 実績数 | 例 |
|---------|---------|--------|-----|
| ログイン | 📅 | 5件 | 初ログイン、3日の友、10日の友... |
| 連続ログイン | 🔥 | 5件 | 2日連続、5日連続、1週間連続... |
| システム作成 | ⚙️ | 5件 | ビギナー、職人、マスター... |
| アルゴリズム作成 | 🧩 | 5件 | ビギナー、職人、マスター... |
| AI会話 | 💬 | 5件 | デビュー、フレンド、マスター... |
| AI連続会話 | 💭 | 5件 | ビギナー、パートナー、レジェンド... |
| チェックリスト作成 | 📝 | 5件 | 入門、職人、マスター... |
| チェックリスト完了 | ✅ | 5件 | ハンター、マスター、チャンピオン... |
| アクセサリー | 🎀 | 5件 | 初心者、ハンター、スタイリスト... |

**合計**: 45件

### ランク別報酬

| ランク | 報酬コイン |
|--------|-----------|
| ブロンズ | 100コイン |
| シルバー | 200コイン |
| ゴールド | 300コイン |
| プラチナ | 500コイン |
| ダイヤモンド | 1000コイン |

---

## ❓ トラブルシューティング

### 問題1: マイグレーション実行時にエラー

**症状**: `migrate` 実行時にエラーが発生

**解決**:
```bash
# マイグレーションをリセット
python manage.py migrate codemon 0009
python manage.py migrate
```

---

### 問題2: 実績が表示されない

**確認手順**:
1. データベースに実績が存在するか確認
   ```bash
   python check_achievements_data.py
   ```

2. 総実績数が0件の場合、マイグレーションを再実行
   ```bash
   python manage.py migrate codemon 0009
   python manage.py migrate
   ```

---

### 問題3: 既にデータがあるがスキップされた

**症状**: マイグレーション実行時に「既に存在します。スキップします。」と表示

**状態**: これは正常です！

**説明**: 既にデータベースに実績データが存在する場合、重複作成を防ぐためスキップされます。

**確認**:
```bash
python check_achievements_data.py
# 総実績数: 45 と表示されればOK
```

---

## 🔄 データをリセットしたい場合

開発中に実績データをクリーンな状態に戻したい場合：

```bash
# マイグレーションをロールバック（実績データ削除）
python manage.py migrate codemon 0009

# 再度マイグレーション（実績データ自動作成）
python manage.py migrate
```

---

## 📝 補足情報

### 手動実行スクリプト（非推奨）

マイグレーションを使わず手動で作成したい場合（通常は不要）：

```bash
python create_all_achievements.py
```

**⚠️ 注意**: マイグレーションで自動作成されるため、通常このスクリプトを実行する必要はありません。

---

## ✅ チェックリスト

セットアップ完了の確認：

- [ ] `git pull origin main` でコード最新化
- [ ] `python manage.py migrate` 実行
- [ ] 「✅ 実績データ 45 件を作成しました！」と表示される
- [ ] `python check_achievements_data.py` で45件確認
- [ ] ブラウザで実績画面が正しく表示される

---

## 🆘 サポート

問題が解決しない場合：

1. [ACHIEVEMENT_FIX_PROGRESS.md](ACHIEVEMENT_FIX_PROGRESS.md) を確認
2. エラーメッセージをスクリーンショット
3. チームに報告

---

**作成者**: AI開発アシスタント  
**日付**: 2026年2月6日  
**バージョン**: 1.0
