"""
チェックリスト期限機能 - 実装完了ガイド
"""

print("""
╔═══════════════════════════════════════════════════════════════════╗
║        📅 チェックリスト期限機能の実装完了                        ║
╚═══════════════════════════════════════════════════════════════════╝

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
✨ 実装した機能
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

1. チェックリスト作成時の期限設定
   ファイル: codemon/templates/codemon/checklist_create.html
   追加: カレンダー入力欄（<input type="date">）
   説明文: 「※期限を決めると、ホーム画面に「あと〇日！」と表示されるよ」

2. データベースモデルの拡張
   ファイル: codemon/models.py
   追加フィールド: Checklist.due_date (DateField)
   追加メソッド: days_until_due() - 期限までの残り日数を計算

3. チェックリスト作成・編集ビューの更新
   ファイル: codemon/views.py
   機能: 
   - POST時に期限を保存
   - 編集時に期限を読み込み
   - セッションに期限データを保持

4. ホーム画面での期限表示
   ファイル: accounts/templates/accounts/karihome.html
   表示位置: アカウントボタンの右側
   表示内容: 
   - チェックリスト名（最大15文字）
   - 残り日数（「今日！」「明日！」「あと〇日！」）
   色分け:
   - 🔴 今日・1-3日以内: 赤色（緊急）
   - 🟡 4-7日以内: 黄色（注意）
   - 🟢 8日以上: 通常


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🎯 使い方
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

【チェックリスト作成時】

1. チェックリスト作成画面にアクセス
   URL: http://127.0.0.1:8000/codemon/checklist_create/

2. 必須項目を入力
   - リストの名前: 例「宿題セット」
   - やる内容: 各項目を追加

3. 期限を設定（任意）
   - カレンダーアイコンをクリック
   - 日付を選択（例: 2026-02-10）
   - 期限なしでも作成可能

4. 「リストをつくる！」ボタンをクリック


【ホーム画面での確認】

1. ホーム画面にアクセス
   URL: http://127.0.0.1:8000/accounts/karihome/

2. アカウントボタンとコイン表示の間に期限が表示される
   例:
   ┌────────────────────┐
   │ 宿題セット あと3日！│  ← 赤色で強調
   └────────────────────┘

3. 最大3件まで表示（期限の近い順）


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📊 表示ルール
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

【期限の色分け】
- 残り0-3日:  🔴 赤色（urgent）
  → 背景: #ff7675, 影: #cc3333
  
- 残り4-7日:  🟡 黄色（near）
  → 背景: #ffd700, 影: #cc8400
  
- 残り8日以上: 🟢 通常
  → 背景: #ffcc00, 影: #d99300


【表示テキスト】
- 今日が期限: 「今日！」
- 明日が期限: 「明日！」  
- それ以降: 「あと〇日！」


【表示条件】
- 期限が今日以降のもののみ表示
- 過去の期限は表示されない
- 期限未設定のチェックリストは表示されない
- 最大3件まで表示


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🔧 技術詳細
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

【データベース】
テーブル: checklist
新規カラム: due_date (DATE型, NULL可)

【マイグレーション】
ファイル: codemon/migrations/0007_checklist_due_date.py
コマンド: 
  python manage.py makemigrations codemon
  python manage.py migrate codemon


【ビューの処理フロー】

1. checklist_create (POST)
   ↓
   due_date_str = request.POST.get('due_date')
   ↓
   datetime.strptime(due_date_str, '%Y-%m-%d').date()
   ↓
   Checklist.objects.create(due_date=due_date)

2. karihome
   ↓
   Checklist.objects.filter(
       user=acc,
       due_date__isnull=False,
       due_date__gte=today
   ).order_by('due_date')[:3]
   ↓
   テンプレートに upcoming_checklists を渡す


【テンプレート処理】
{% for checklist in upcoming_checklists %}
  {% with days=checklist.days_until_due %}
    {% if days == 0 %}今日！
    {% elif days == 1 %}明日！
    {% else %}あと{{ days }}日！
    {% endif %}
  {% endwith %}
{% endfor %}


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
✅ 動作確認手順
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Step 1: チェックリストを作成
  1. http://127.0.0.1:8000/codemon/checklist_create/ にアクセス
  2. 名前: 「テスト期限リスト」
  3. 期限: 3日後の日付を選択
  4. 項目: 適当に1つ追加
  5. 作成ボタンをクリック

Step 2: ホーム画面で確認
  1. http://127.0.0.1:8000/accounts/karihome/ にアクセス
  2. アカウントボタンの右側を確認
  3. 「テスト期限リスト あと3日！」が表示される
  4. 黄色の背景で表示される（4-7日以内）

Step 3: 期限が近いチェックリストを作成
  1. 新しいチェックリストを作成
  2. 名前: 「緊急タスク」
  3. 期限: 明日の日付を選択
  4. 作成ボタンをクリック

Step 4: 色分けを確認
  1. ホーム画面に戻る
  2. 「緊急タスク 明日！」が赤色で表示される
  3. 期限の近い順に並んでいることを確認


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🎨 デザイン仕様
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

.deadline-item {
  - padding: 8px 16px
  - border-radius: 20px
  - font-weight: 900
  - font-size: 13px
  - box-shadow: 0 4px 0 (色に応じて変化)
  - animation: pulse 2s infinite (ゆっくり拡大縮小)
}

アニメーション効果:
  - 2秒かけてゆっくり拡大縮小
  - ユーザーの注意を引く
  - うるさくない程度の控えめな動き


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📝 今後の拡張案
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

1. 期限切れ通知
   - 期限が過ぎたチェックリストを別表示
   - 「期限切れ！」というラベル

2. リマインダー機能
   - 期限の〇日前に通知
   - メール通知機能

3. カレンダービュー
   - 月間カレンダーでチェックリストを表示
   - 日付をクリックして詳細表示

4. 繰り返し設定
   - 毎日、毎週などの繰り返し
   - 自動的に期限を更新


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

""")
