# チュートリアルテンプレートシステム作成ガイド

## 概要
新規ユーザー登録時に自動的にコピーされる「正解」「不正解」システムのテンプレートを作成します。

## 作成手順

### 1. 管理者アカウントでログイン

現在の設定では、**user_id=1** の `rg` ユーザー（account_type=student）がテンプレート作成者です。

#### ログイン方法:

1. 開発サーバーを起動:
   ```powershell
   cd c:\Users\r_goto\.vscode\codemon\appproject
   python manage.py runserver
   ```

2. ブラウザでログインページにアクセス:
   - **生徒用ログイン**: http://localhost:8000/accounts/student_login/
   - (または教員用: http://localhost:8000/accounts/teacher_login/)
   
3. ログイン情報を入力:
   - **ユーザー名**: `rg`
   - **パスワード**: (設定済みのパスワード)

#### パスワードを忘れた場合:

新しいパスワードを設定するには、以下のスクリプトを実行:

```powershell
cd c:\Users\r_goto\.vscode\codemon\appproject
python reset_user1_password.py
```

このスクリプトで user_id=1 のパスワードを `newpassword123` にリセットできます。

### 2. 「正解」システムの作成

1. ログイン後、システム一覧画面に移動
2. 「新しいシステムを作る」ボタンをクリック
3. システム名: **正解**（この名前は必須）
4. システム説明: チュートリアル用の正解画面
5. 「作成」ボタンをクリック
6. システム編集画面で好きなレイアウトを作成:
   - 左側のツールバーから要素を選択（ラベル、ボタン、入力欄など）
   - キャンバスにドラッグ＆ドロップで配置
   - 要素をクリックして色、サイズ、位置を調整
   - 例: 大きな「せいかい！」テキスト、お祝いメッセージ、次へボタンなど
7. 完成したら「保存」をクリック

### 3. 「不正解」システムの作成

1. システム一覧画面に戻る
2. 再度「新しいシステムを作る」ボタンをクリック
3. システム名: **不正解**（この名前は必須）
4. システム説明: チュートリアル用の不正解画面
5. 「作成」ボタンをクリック
6. システム編集画面で好きなレイアウトを作成:
   - 例: 「ざんねん...もういちど！」テキスト、励ましメッセージ、もう一度ボタンなど
7. 完成したら「保存」をクリック

## コピーされる情報

新規ユーザー登録時、以下の情報が完全にコピーされます:

- システム名と説明
- すべての要素（ラベル、ボタン、入力欄など）
- 要素の種類（element_type）
- 要素のラベルと値（element_label, element_value）
- 位置とサイズ（position_x, position_y, width, height）
- スタイル（style_data: 色、フォントサイズ、配置など）
- 設定（element_config）
- 並び順（sort_order）

## フォールバック動作

テンプレートシステムが存在しない場合、以下のデフォルトシステムが作成されます:

### デフォルト「正解」システム
- ラベル: 「せいかい！」
- 位置: (400, 300)
- サイズ: 300×100
- スタイル: 緑色、48px、太字、中央揃え

### デフォルト「不正解」システム
- ラベル: 「ざんねん...もういちど！」
- 位置: (400, 300)
- サイズ: 400×100
- スタイル: 赤色、36px、太字、中央揃え

## テンプレート更新の注意点

- テンプレートを更新しても、**既存ユーザーには影響しません**
- 変更は新規登録するユーザーにのみ適用されます
- 既存ユーザーのシステムを更新する場合は、別途手動で修正が必要

## 動作確認

テンプレートを作成後、`test_template_copy.py` を実行して動作確認できます:

```powershell
cd c:\Users\r_goto\.vscode\codemon\appproject
python test_template_copy.py
```

期待される出力:
- ✅ テンプレートユーザー確認
- ✅ 「正解」システム検出（要素数も表示）
- ✅ 「不正解」システム検出（要素数も表示）
- ✅ テストユーザーへの正解システムコピー（同じ要素数）
- ✅ テストユーザーへの不正解システムコピー（同じ要素数）
- ✅ 要素数一致の検証

## 設定ファイル

テンプレートユーザーIDは `appproject/settings.py` で変更できます:

```python
# チュートリアルシステムのテンプレートとなるユーザーID
TUTORIAL_TEMPLATE_USER_ID = 1
```

## トラブルシューティング

### テンプレートが検出されない
- システム名が正確に「正解」「不正解」になっているか確認
- TUTORIAL_TEMPLATE_USER_ID の設定が正しいか確認
- そのユーザーIDが実際に存在するか確認

### コピーされた要素が表示されない
- テンプレートシステムの要素が正しく保存されているか確認
- position_x, position_y の値が表示領域内か確認
- style_data の visibility や display 設定を確認

### 新規ユーザーにシステムが作成されない
- teacher_signup / student_signup で create_tutorial_systems が呼ばれているか確認
- エラーログを確認（エラーでもユーザー登録は継続されます）
