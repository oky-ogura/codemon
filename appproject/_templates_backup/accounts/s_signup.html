    <div class="container">
        <section class="panel-right centered">
            <h2>新しく始めよう！</h2>
            <form method="post" class="signup-form">
                {% csrf_token %}

                {# 全体の非フィールドエラー表示 #}
                {% if form.non_field_errors %}
                    <div class="form-errors">
                        {% for err in form.non_field_errors %}
                            <div class="error">{{ err }}</div>
                        {% endfor %}
                    </div>
                {% endif %}

                <div class="form-grid">
                    <label class="label">名前</label>
                    <div class="control">
                        <input type="text" id="id_name" name="user_name" required value="{{ form.user_name.value|default_if_none:'' }}">
                        {% if form.user_name.errors %}
                            <div class="error">{{ form.user_name.errors.0 }}</div>
                        {% endif %}
                    </div>

                    <label class="label">年齢</label>
                    <div class="control age-wrap">
                        <select id="id_age" name="age">
                            <option value="">▽</option>
                            {% for i in ages %}
                                <option value="{{ i }}"{% if form.age.value|stringformat:"s" == i|stringformat:"s" %} selected{% endif %}>{{ i }}歳</option>
                            {% endfor %}
                        </select>
                        {% if form.age.errors %}
                            <div class="error">{{ form.age.errors.0 }}</div>
                        {% endif %}
                    </div>

                    <label class="label">メールアドレス</label>
                    <div class="control">
                        <input type="email" id="id_email" name="email" required value="{{ form.email.value|default_if_none:'' }}">
                        {% if form.email.errors %}
                            <div class="error">{{ form.email.errors.0 }}</div>
                        {% endif %}
                    </div>

                    <label class="label">パスワード</label>
                    <div class="control"><input type="password" id="id_password1" name="password1" required></div>
                    {% if form.password1.errors %}
                        <div class="error">{{ form.password1.errors.0 }}</div>
                    {% endif %}

                    <label class="label">パスワード確認</label>
                    <div class="control"><input type="password" id="id_password2" name="password2" required></div>
                    {% if form.password2.errors %}
                        <div class="error">{{ form.password2.errors.0 }}</div>
                    {% endif %}

                    {# アカウント種別はこのテンプレートが生徒用なので固定する（ユーザーによる選択は外す） #}
                    <input type="hidden" name="role" value="student">
                </div>

                <div class="submit-area">
                    <!-- フォームを送信してアカウントを作成し、次の AI 外見設定画面へ移動 -->
                    <button type="submit" class="big-btn">新しく作る</button>
                </div>
            </form>
        <style>
            :root{ --bg:#f8fafc; --muted:#444; --accent:#4b90ff }
            body{margin:0;background:var(--bg);font-family:Meiryo, 'Hiragino Kaku Gothic ProN', 'Segoe UI',sans-serif;color:#222}
            .container{max-width:760px;margin:28px auto;padding:0;background:transparent}
            .panel-right{background:#fff;padding:36px 40px;border:2px solid #111}
            .panel-right h2{text-align:center;margin:0 0 18px 0}
            .form-grid{display:grid;grid-template-columns:140px 1fr;row-gap:18px;column-gap:24px;align-items:center}
            .label{font-size:16px;color:var(--muted);text-align:left}
            .control input[type=text], .control input[type=email], .control input[type=password], .control select{width:260px;padding:8px 10px;border:1px solid #333;border-radius:4px}
            .age-wrap select{width:120px}
            .submit-area{text-align:center;margin-top:28px}
            .big-btn{background:#e7f0ff;color:#2b5db6;border-radius:12px;padding:12px 36px;border:none;font-size:18px;cursor:pointer}
            @media(max-width:780px){.container{padding:10px}.panel-right{padding:20px}.control input{width:100%}.form-grid{grid-template-columns:1fr}}
        </style>
