<!DOCTYPE html>
<html lang="ja">
<head>
    {% load static %}
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>AI外見設定</title>
    <style>
        body{
            margin:0;
            font-family:Meiryo, 'Hiragino Kaku Gothic ProN',sans-serif;
            background:#f8fafc url("{% static 'accounts/background.png' %}") no-repeat center center fixed;
            background-size:cover;
        }
        .wrap{
            max-width:980px;
            margin:20px auto;
            padding:20px 16px;
            border-radius:12px;
        }
        h1{
            text-align:center;
            margin-top:0;
            margin-bottom:20px;
            font-size:28px;
            font-weight:bold;
        }
        .canvas{
            position:relative;
            height:300px;
            display:flex;
            align-items:center;
            justify-content:center;
            margin-bottom:20px;
        }
        .illustration{
            width:250px;
            height:250px;
            display:block;
            border:none;
            background:transparent;
            border-radius:0;
            object-fit:contain;
        }
        .nav-left,.nav-right{
            position:absolute;
            left:40px;
            top:50%;
            transform:translateY(-50%);
            cursor:pointer;
            transition:opacity 0.2s;
        }
        .nav-left:hover,.nav-right:hover{
            opacity:0.7;
        }
        .nav-right{
            left:auto;
            right:40px;
        }
        .nav-button{
            width:48px;
            height:48px;
            border-radius:8px;
            border:2px solid #333;
            background:#fff;
            display:flex;
            align-items:center;
            justify-content:center;
            font-size:20px;
        }
        .controls{
            display:flex;
            justify-content:space-between;
            padding:0 40px;
            margin-top:35px;
        }
        .btn{
            font-size:1rem;
            color:#000000;
            text-transform:uppercase;
            padding:5px 10px;
            border-radius:10px;
            border-top:2px solid #ff8c00;
            border-left:2px solid #ff8c00;
            border-right:2px solid #fafafa;
            border-bottom:2px solid #fafafa;
            background:#ffffff;
            box-shadow:5px 5px 0 #00bfff;
            cursor:pointer;
            transition:transform 0.1s;
        }
        .btn:hover{
            transform:translate(2px, 2px);
            box-shadow:3px 3px 0 #00bfff;
        }
        .btn:active{
            transform:translate(5px, 5px);
            box-shadow:0 0 0 #00bfff;
        }
    </style>
</head>
<body>
    <div class="wrap">
        <h1>CodeMonの見た目を決めよう！</h1>
        <div class="canvas">
            <div class="nav-left" id="prev"><div class="nav-button">◀</div></div>
            <!-- 画像表示用に div を img に変更 -->
            <img class="illustration" id="illustration" src="" alt="AIのイラスト（大きく）">
            <div class="nav-right" id="next"><div class="nav-button">▶</div></div>
        </div>

        <form method="post" id="aiForm">
            {% csrf_token %}
            <input type="hidden" name="appearance" id="appearanceInput" value="triangle">
            <div class="controls">
                <button type="button" class="btn" id="backBtn">戻る</button>
                <button type="submit" class="btn" id="decideBtn">決定</button>
            </div>
        </form>
    </div>

    <script>
        // baseStatic は static/accounts/ への URL
        const baseStatic = "{% static 'accounts/' %}";
        const appearances = {{ appearances|safe }};
        let idx = 0;
        const illustration = document.getElementById('illustration');
        const appearanceInput = document.getElementById('appearanceInput');

        function render(){
            const filename = appearances[idx];
            appearanceInput.value = filename;
            if(filename){
                // 日本語ファイル名にも対応するため encodeURIComponent を使用
                illustration.src = baseStatic + encodeURIComponent(filename);
                illustration.alt = filename;
            } else {
                illustration.removeAttribute('src');
                illustration.alt = 'AIのイラスト（大きく）';
            }
        }

        document.getElementById('prev').addEventListener('click',()=>{ idx = (idx-1+appearances.length)%appearances.length; render(); });
        document.getElementById('next').addEventListener('click',()=>{ idx = (idx+1)%appearances.length; render(); });
        document.getElementById('backBtn').addEventListener('click',()=>{ window.history.back(); });
        render();
    </script>
</body>
</html>