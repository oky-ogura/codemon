{% extends 'base.html' %}
{% load static %}

{% block title %}アカウント{% endblock %}

{% block background_frame %}
<img src="{% static 'codemon/images/frames/生徒用アカウント画面 (2).png' %}" 
     alt="" 
     class="bg-frame">
{% endblock %}

{% block extra_css %}
<style>
  .account-container{
    position:relative;
    width:100%;
    height:calc(100vh - 120px);
    margin-top:100px;
    padding:20px 60px;
    box-sizing:border-box;
  }
  
  /* 左側：ユーザー情報エリア */
  .user-info-area{
    position:absolute;
    left:15%;
    top:50%;
    transform:translateY(-50%);
  }
  
  /* ユーザー名アイコン */
  .user-icon{
    width:80px;
    height:80px;
    border-radius:50%;
    border:3px solid #4fc3f7;
    margin-bottom:20px;
    background:#4fc3f7;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:32px;
    font-weight:bold;
    color:#fff;
  }
  
  .info .row{margin-bottom:20px;display:flex;align-items:center;gap:20px}
  .label{display:inline-block;min-width:60px;color:#333;font-weight:500;text-align:right;font-size:16px}
  .value-box{background:#4fc3f7;color:#000;padding:10px 40px;border-radius:30px;font-weight:bold;min-width:150px;text-align:left;display:inline-block;font-size:16px}
  
  /* 右側：AI情報エリア */
  .ai-info-area{
    position:absolute;
    left:50%;
    top:60%;
    transform:translate(-50%, -50%);
    text-align:center;
  }
  
  .ai-character{
    width:200px;
    height:200px;
    object-fit:contain;
    margin-bottom:15px;
  }
  
  .ai-details{
    text-align:right;
    color:#666;
    font-size:14px;
    line-height:1.8;
  }
  
  /* ログアウトボタン：左下 */
  .logout-area{
    position:absolute;
    left:15%;
    bottom:15%;
  }
  
  .btn-logout{
    font-size:1rem;
    color:#000000;
    padding:8px 20px;
    border-radius:10px;
    border-top:2px solid #ff8c00;
    border-left:2px solid #ff8c00;
    border-right:2px solid #fafafa;
    border-bottom:2px solid #fafafa;
    background:#ffffff;
    box-shadow:5px 5px 0 #00bfff;
    cursor:pointer;
    text-decoration:none;
    display:inline-block;
  }
  .btn-logout:hover{
    opacity:0.9;
  }

/* モーダル */
#confirm-modal{position:fixed;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,0.4);display:none;align-items:center;justify-content:center;z-index:9999}
#confirm-modal .box{background:#fff;padding:20px;border-radius:8px;min-width:320px;text-align:center}
#confirm-modal .buttons{margin-top:16px;display:flex;gap:12px;justify-content:center}
#confirm-modal .btn{padding:8px 14px;border-radius:6px;border:none;cursor:pointer}
#confirm-modal .yes{background:#f46b6b;color:#fff}
#confirm-modal .no{background:#e0e6ef}
</style>
{% endblock %}

{% block content %}
  <div class="account-container">
    <!-- 左側：ユーザー情報 -->
    <div class="user-info-area">
      <!-- ユーザー名アイコン -->
      <div class="user-icon">
        {% if account and account.user_name %}{{ account.user_name|slice:":1" }}{% else %}?{% endif %}
      </div>
      <div class="info">
        <div class="row">
          <span class="label">ID</span>
          <span class="value-box">{% if account %}{{ account.user_id }}{% else %}---{% endif %}</span>
        </div>

        <div class="row">
          <span class="label">名前</span>
          <span class="value-box">{% if account %}{{ account.user_name }}{% else %}ゲスト{% endif %}</span>
        </div>

        <div class="row">
          <span class="label">年齢</span>
          <span class="value-box">{% if account and account.age is not None %}{{ account.age }}歳{% else %}--{% endif %}</span>
        </div>
      </div>
    </div>

    <!-- 右側：AI情報 -->
    <div class="ai-info-area">
      {% if ai_config and ai_config.appearance %}
        <img src="{% static 'codemon/images/characters/' %}{{ ai_config.appearance }}" 
             alt="AI" 
             class="ai-character"
             onerror="this.src='{% static 'codemon/images/characters/イヌ.png' %}'">
      {% else %}
        <img src="{% static 'codemon/images/characters/イヌ.png' %}" 
             alt="AI" 
             class="ai-character">
      {% endif %}
      <div class="ai-details">
        <div>名前　{{ ai_config.ai_name|default:"CodeMon" }}</div>
        <div>初めて会った日　{% if first_met %}{{ first_met|date:"Y/m/d" }}{% else %}--{% endif %}</div>
        <div>累計　{% if total_days %}{{ total_days }}{% else %}0日{% endif %}</div>
      </div>
    </div>

    <!-- 左下：ログアウトボタン -->
    <div class="logout-area">
      <form id="logout-form" method="post" action="{% url 'accounts:logout' %}" style="display:inline">
        {% csrf_token %}
        <button type="submit" id="logout-btn" class="btn-logout">ログアウト</button>
      </form>
    </div>
  </div>

  <!-- 確認モーダル -->
  <div id="confirm-modal" aria-hidden="true">
    <div class="box" role="dialog" aria-modal="true" aria-labelledby="confirm-title">
      <div id="confirm-title">ログアウトしますか？</div>
      <div class="buttons">
        <button class="btn yes" id="confirm-yes">はい</button>
        <button class="btn no" id="confirm-no">いいえ</button>
      </div>
    </div>
  </div>
{% endblock %}
