    <div class="container">
        <section class="panel-right centered">
            <h2>新しく始めよう！</h2>
            <form method="post" class="signup-form">
                {% csrf_token %}

                {# 全体の非フィールドエラー表示 #}
                {% if form.non_field_errors %}
                    <div class="form-errors">
                        {% for err in form.non_field_errors %}
                            <div class="error">{{ err }}</div>
                        {% endfor %}
                    </div>
                {% endif %}

                <div class="form-grid">
                    <div class="form-row">
                        <label class="form-label">名前</label>
                        <input type="text" class="form-input" id="id_name" name="user_name" required value="{{ form.user_name.value|default_if_none:'' }}">
                        {% if form.user_name.errors %}
                            <div class="error">{{ form.user_name.errors.0 }}</div>
                        {% endif %}
                    </div>

                    <div class="form-row">
                        <label class="form-label">年齢</label>
                        <select class="form-input" id="id_age" name="age">
                            <option value="">▽</option>
                            {% for i in ages %}
                                <option value="{{ i }}"{% if form.age.value|stringformat:"s" == i|stringformat:"s" %} selected{% endif %}>{{ i }}歳</option>
                            {% endfor %}
                        </select>
                        {% if form.age.errors %}
                            <div class="error">{{ form.age.errors.0 }}</div>
                        {% endif %}
                    </div>

                    <div class="form-row">
                        <label class="form-label">メールアドレス</label>
                        <input type="email" class="form-input" id="id_email" name="email" required value="{{ form.email.value|default_if_none:'' }}">
                        {% if form.email.errors %}
                            <div class="error">{{ form.email.errors.0 }}</div>
                        {% endif %}
                    </div>

                    <div class="form-row">
                        <label class="form-label">パスワード</label>
                        <input type="password" class="form-input" id="id_password1" name="password1" required>
                        {% if form.password1.errors %}
                            <div class="error">{{ form.password1.errors.0 }}</div>
                        {% endif %}
                    </div>

                    <div class="form-row">
                        <label class="form-label">パスワード確認</label>
                        <input type="password" class="form-input" id="id_password2" name="password2" required>
                        {% if form.password2.errors %}
                            <div class="error">{{ form.password2.errors.0 }}</div>
                        {% endif %}
                    </div>

                    {# アカウント種別はこのテンプレートが生徒用なので固定する（ユーザーによる選択は外す） #}
                    <input type="hidden" name="role" value="student">
                </div>

                <div class="submit-area">
                    <!-- フォームを送信してアカウントを作成し、次の AI 外見設定画面へ移動 -->
                    <button type="submit" class="big-btn">決定</button>
                </div>
            </form>
        {% load static %}
        <style>
            :root{ --bg:#f8fafc; --muted:#444; --accent:#4b90ff }
            body{
                margin:0;
                background:var(--bg);
                font-family:Meiryo, 'Hiragino Kaku Gothic ProN', 'Segoe UI',sans-serif;
                color:#222;
                background-image:url('{% static "accounts/signup_bg.png" %}');
                background-size:cover;
                background-position:center;
                background-repeat:no-repeat;
                background-attachment:fixed;
                overflow:hidden;
                height:100vh;
            }
            .container{max-width:900px;margin:0 auto;padding:10px 20px;background:transparent;display:flex;align-items:center;justify-content:center;min-height:100vh}
            .panel-right{background:transparent;padding:10px 30px;border-radius:20px;box-shadow:none}
            .panel-right h2{text-align:center;margin:0 0 10px 0;font-size:26px}
            .form-grid{display:flex;flex-direction:column;gap:8px;align-items:center}
            .form-row{
                display:flex;
                align-items:center;
                margin:8px 0;
                gap:20px;
                width:100%;
                max-width:600px;
            }
            .form-label{
                background:#ffffff;
                padding:8px 20px;
                border-radius:40px;
                font-size:18px;
                font-weight:600;
                color:#333;
                flex-shrink:0;
                box-shadow:0 2px 5px rgba(0,0,0,0.1);
                min-width:180px;
                text-align:center;
            }
            .form-input{
                background:#5BD4F0;
                border:none;
                border-radius:40px;
                padding:8px 16px;
                height:38px;
                font-size:16px;
                outline:none;
                flex-grow:1;
                color:#fff;
                appearance:none;
            }
            .form-input::placeholder{color:rgba(255,255,255,0.7)}
            .form-input:focus{background:#4AC5E0}
            select.form-input{
                background-image:url('data:image/svg+xml;utf8,<svg fill="white" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>');
                background-repeat:no-repeat;
                background-position:right 15px center;
                cursor:pointer;
            }
            select.form-input option{background:#fff;color:#333}
            .submit-area{text-align:center;margin-top:15px}
            .big-btn{
                font-size:1rem;
                color:#000000;
                text-transform:uppercase;
                padding:5px 10px;
                border-radius:10px;
                border-top:2px solid #ff8c00;
                border-left:2px solid #ff8c00;
                border-right:2px solid #fafafa;
                border-bottom:2px solid #fafafa;
                background:#ffffff;
                box-shadow:5px 5px 0 #00bfff;
                cursor:pointer;
                margin:35px 0;
                font-weight:bold;
            }
            .big-btn:hover{background:#f0f8ff}
            .error{color:#e74c3c;margin-top:5px;font-size:14px}
            @media(max-width:780px){
                .container{padding:10px}
                .panel-right{padding:25px}
                .form-row{flex-direction:column;align-items:stretch;gap:8px}
                .form-label{min-width:auto;text-align:center}
                .form-input{width:100%}
            }
        </style>
