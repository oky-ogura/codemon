{% extends 'base.html' %}
{% load static %}

{% block background_frame %}
<img src="{% static 'codemon/images/frames/bg_frame_purple.png' %}"
  alt=""
  class="bg-frame"
  onerror="this.style.display='none';">
{% endblock %}

{% block title %}アルゴリズム詳細 - Codemon{% endblock %}

{% block extra_css %}
<link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
  :root {
    --bg-main: #f0f4f8;
    --panel-bg: rgba(255, 255, 255, 0.95);
    --accent-main: #9b59b6;    /* 紫（アルゴリズムテーマ） */
    --btn-pop: #FFD200;       /* イエロー */
    --btn-shadow: #e6bd00;
    --btn-purple-shadow: #7d3c98;
    --error-pop: #ff7675;     /* ピンク */
    --error-shadow: #e15f5e;
    --text-dark: #2d3748;
    --input-bg: #f8fafc;
  }

  html, body {
    background-color: var(--bg-main);
    font-family: "M PLUS Rounded 1c", sans-serif;
    height: 100vh;
    overflow: hidden;
    margin: 0;
    padding: 0;
    position: fixed;
    width: 100%;
  }

  .content-wrapper {
    height: 100vh;
    overflow: hidden !important;
    padding: 0 !important;
  }

  main {
    width: 100%;
    height: calc(100vh - 80px);
    max-width: 1100px; 
    margin: 0 auto;
    padding: 80px 40px 0 40px;
    box-sizing: border-box;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
  }

  /* パネル全体 */
  .detail-panel {
    background: var(--panel-bg);
    border: 6px solid var(--accent-main);
    border-radius: 30px;
    padding: 30px;
    width: 100%;
    height: calc(100vh - 100px);
    max-height: calc(100vh - 100px);
    box-shadow: 0 15px 0 rgba(155, 89, 182, 0.2), 0 10px 30px rgba(0,0,0,0.1);
    display: flex;
    flex-direction: column;
    overflow: hidden; 
  }

  /* ヘッダーエリア */
  .panel-header {
    text-align: center;
    border-bottom: 3px dashed #e2e8f0;
    padding-bottom: 15px;
    margin-bottom: 20px;
    flex-shrink: 0;
  }
  
  .panel-title {
    font-size: 24px;
    font-weight: 800;
    color: var(--accent-main);
    margin: 0;
    display: inline-flex;
    align-items: center;
    gap: 10px;
  }

  /* コンテンツエリア（左右分割） */
  .panel-body {
    display: flex;
    gap: 30px;
    flex: 1; 
    overflow: hidden;
    flex-direction: column; /* スマホファーストで縦並び、PCで横並び */
  }

  @media (min-width: 801px) {
    .panel-body {
      flex-direction: row; /* PC画面では横並び */
    }
  }

  /* --- 左カラム（基本情報） --- */
  .left-column {
    flex: 0 0 350px; /* 幅固定 */
    display: flex;
    flex-direction: column;
    gap: 20px;
  }

  /* --- 右カラム（詳細説明） --- */
  .right-column {
    flex: 1;
    display: flex;
    flex-direction: column;
    height: 100%; /* 高さいっぱい使う */
  }

  /* フォームグループ */
  .form-group {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .form-label {
    font-size: 15px;
    font-weight: 800;
    color: var(--text-dark);
    display: flex;
    align-items: center;
    gap: 8px;
  }
  
  .form-label i {
    color: var(--accent-main);
    font-size: 18px;
  }

  .read-only-field {
    padding: 12px 15px;
    border-radius: 15px;
    border: 3px solid #cbd5e0;
    background: var(--input-bg);
    color: var(--text-dark);
    font-size: 16px;
    font-weight: 700;
    font-family: inherit;
    width: 100%;
    box-sizing: border-box;
  }

  /* テキストエリア */
  .textarea-wrapper {
    flex: 1;
    display: flex;
    flex-direction: column;
    height: 100%; /* 親要素に合わせて伸びる */
  }
  
  textarea.read-only-field {
    flex: 1; 
    resize: none;
    line-height: 1.6;
    overflow-y: auto;
    height: 100%; /* 高さを確保 */
  }
  
  textarea.read-only-field::-webkit-scrollbar { width: 10px; }
  textarea.read-only-field::-webkit-scrollbar-track { background: #f1f5f9; border-radius: 5px; }
  textarea.read-only-field::-webkit-scrollbar-thumb { background: #cbd5e0; border-radius: 5px; }

  /* --- アクションボタンエリア（最下部に横並び配置） --- */
  .action-area {
    margin-top: auto; /* 下に押し下げる */
    padding-top: 20px;
    border-top: 3px dashed #e2e8f0;
    display: flex;
    justify-content: center;
    gap: 15px;
    flex-wrap: wrap; /* 画面が狭いときは折り返す */
  }

  .action-btn {
    border: none;
    padding: 12px 24px;
    border-radius: 50px;
    font-weight: 800;
    font-size: 15px;
    cursor: pointer;
    transition: all 0.1s;
    font-family: inherit;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    flex: 1; /* ボタン幅を均等に */
    min-width: 120px; /* 最小幅 */
  }

  /* 編集ボタン */
  .btn-edit {
    background: var(--btn-pop); color: #5d4037; box-shadow: 0 4px 0 var(--btn-shadow);
  }
  .btn-edit:hover { transform: translateY(2px); box-shadow: 0 2px 0 var(--btn-shadow); background: #ffe033; }
  .btn-edit:active { transform: translateY(4px); box-shadow: none; }

  /* 削除ボタン */
  .btn-delete {
    background: var(--error-pop); color: white; box-shadow: 0 4px 0 var(--error-shadow);
  }
  .btn-delete:hover { transform: translateY(2px); box-shadow: 0 2px 0 var(--error-shadow); background: #ff8e8d; }
  .btn-delete:active { transform: translateY(4px); box-shadow: none; }

  /* 戻るボタン */
  .btn-back {
    background: #fff; color: var(--text-dark); border: 2px solid #e2e8f0; box-shadow: 0 4px 0 #cbd5e0;
  }
  .btn-back:hover { transform: translateY(2px); box-shadow: 0 2px 0 #cbd5e0; background: #f7fafc; }
  .btn-back:active { transform: translateY(4px); box-shadow: none; }

  /* レスポンシブ調整 */
  @media (max-width: 800px) {
    body, main { height: auto; overflow: auto; }
    main { padding: 100px 20px 40px 20px; display: block; }
    .detail-panel { height: auto; padding: 20px; }
    .left-column { flex: none; width: 100%; }
    .right-column { flex: none; height: 300px; margin-top: 20px; }
    .action-area { margin-top: 20px; flex-direction: column; }
    .action-btn { width: 100%; }
  }

</style>
{% endblock %}

{% block content %}
{% include 'partials/navigation.html' %}
<main>
  
  <div class="detail-panel" role="region" aria-label="アルゴリズム詳細">
    
    <div class="panel-header">
      <h1 class="panel-title">
        <i class="fas fa-info-circle"></i> アルゴリズムのくわしいじょうほう
      </h1>
    </div>

    <div class="panel-body">
      
      <div class="left-column">
        <div class="form-group">
          <label class="form-label">
            <i class="fas fa-puzzle-piece"></i> アルゴリズムのなまえ
          </label>
          <input type="text" class="read-only-field" value="{{ algorithm.algorithm_name }}" readonly>
        </div>

        <div class="form-group">
          <label class="form-label">
            <i class="far fa-clock"></i> 作った日
          </label>
          <input type="text" class="read-only-field" value="{{ algorithm.created_at|date:'Y年n月j日 H:i' }}" readonly>
        </div>
      </div>

      <div class="right-column">
        <div class="form-group textarea-wrapper">
          <label class="form-label">
            <i class="fas fa-align-left"></i> どんなアルゴリズム？
          </label>
          <textarea class="read-only-field" readonly>{{ algorithm.algorithm_description }}</textarea>
        </div>
      </div>

    </div>

    <div class="action-area">
      <button type="button" class="action-btn btn-edit" id="btn-edit">
        <i class="fas fa-pencil-alt"></i> へんしゅう
      </button>

      <button type="button" class="action-btn btn-delete" id="btn-delete">
        <i class="fas fa-trash-alt"></i> さくじょ
      </button>
      
      <button type="button" class="action-btn btn-back" id="btn-back">
        <i class="fas fa-reply"></i> もどる
      </button>
    </div>

  </div>

</main>

<script>
  document.addEventListener('DOMContentLoaded', function() {

    // ナビタブ操作
    document.querySelectorAll('.nav-tab').forEach(tab => {
      tab.addEventListener('click', function(e) {
        document.querySelectorAll('.nav-tab').forEach(t => {
            t.classList.remove('active');
            t.setAttribute('aria-pressed', 'false');
        });
        this.classList.add('active');
        this.setAttribute('aria-pressed', 'true');

        if (this.id === 'tab-system') {
            window.location.href = '/accounts/system/choice/';
        } else if (this.id === 'tab-algorithm') {
            window.location.href = '/accounts/block/choice/';
        }
      });
    });

    // ボタン遷移設定
    document.getElementById('btn-back').addEventListener('click', function(){
      window.location.href = '/accounts/block/list/';
    });

    document.getElementById('btn-edit').addEventListener('click', function(){
      const algorithmId = '{{ algorithm.algorithm_id }}';
      window.location.href = '/accounts/block/?id=' + algorithmId;
    });

    document.getElementById('btn-delete').addEventListener('click', function(){
      const algorithmId = '{{ algorithm.algorithm_id }}';
      window.location.href = '/accounts/block/delete/?id=' + algorithmId;
    });

  });
</script>

{% endblock %}