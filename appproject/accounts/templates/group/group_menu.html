{% extends 'base.html' %}
{% load static %}

{% block title %}グループメニュー - Codemon{% endblock %}

{% block background_frame %}
<img src="{% static 'codemon/images/frames/frame_brack.png' %}" 
     alt="" 
     class="bg-frame"
     onerror="this.style.display='none';">
{% endblock %}

{% block extra_css %}
<style>
  .container{width:920px;margin:160px auto 80px;background:#fff;border:1px solid #ddd;padding:20px;box-sizing:border-box;box-shadow:0 6px 20px rgba(0,0,0,0.05);max-height:calc(100vh - 260px);overflow-y:auto;}
  .header-row{display:flex;align-items:center;justify-content:space-between;margin:18px 0}
  .group-info{
    padding:0;
    background:url('{% static "codemon/images/nav/red_label.png" %}') no-repeat center/100% 100%;
    height:50px;
    border-radius:25px;
    display:flex;
    align-items:center;
    min-width:400px;
  }
  .group-info .group-name{
    width:200px;
    padding-left:40px;
    font-weight:700;
    color:#333;
    font-size:16px;
  }
  .group-info .member-count{
    flex:1;
    padding-right:20px;
    font-weight:700;
    color:#333;
    font-size:16px;
    text-align:right;
  }
  .add-member{background:#cfe6ff;color:#000;padding:8px 14px;border-radius:8px;border:none;text-decoration:none}
  .btn-back{background:transparent;border:none;padding:4px;cursor:pointer;transition:transform 0.2s ease, opacity 0.2s ease;outline:none;display:inline-block}
  .btn-back:hover{transform:scale(1.1);opacity:0.7}
  .btn-back:focus{outline:none}
  table{width:100%;border-collapse:collapse;margin-top:12px}
  th,td{padding:8px 4px;border-bottom:1px solid #ddd;text-align:center}
  th{border-top:none;border-bottom:2px solid #000;padding-bottom:6px}
  tbody tr{background:url('{% static "codemon/images/nav/white_label.png" %}') no-repeat center/100% 100%}
  .actions{display:flex;gap:2px;justify-content:center;align-items:center}
  .btn-check{background:transparent;padding:0;border:none;transition:transform 0.2s ease, opacity 0.2s ease}
  .btn-check:hover{transform:scale(1.1);opacity:0.8}
  .btn-delete{background:transparent;padding:0;border:none;cursor:pointer;transition:transform 0.2s ease, opacity 0.2s ease}
  .btn-delete:hover{transform:scale(1.1);opacity:0.8}
  .no-data{padding:40px;text-align:center;color:#666}
  
  /* レスポンシブ */
  @media(max-width:720px){
    .container{margin-top:120px;}
  }
</style>
{% endblock %}

{% block content %}
  <div class="container">
    <div class="header-row">
      <div class="group-info">
        <div class="group-name">{% if group %}{{ group.group_name }}{% else %}グループ{% endif %}</div>
        <div class="member-count">{% if member_count is not None %}{{ member_count }}人{% else %}0人{% endif %}</div>
      </div>
      <div>
        <a href="{% url 'accounts:account_entry' %}" class="btn-back" aria-label="アカウント画面に戻る">
          <img src="{% static 'codemon/images/nav/back.png' %}" alt="戻る" style="height:40px;display:block;" onerror="this.textContent='← 戻る';this.style.padding='8px 14px';this.style.background='#e0e6ef';this.style.borderRadius='8px';this.style.fontSize='14px';">
        </a>
      </div>
    </div>

    <table>
      <thead>
        <tr>
          <th style="width:20%">ID</th>
          <th style="width:35%">名前</th>
          <th style="width:45%"></th>
        </tr>
      </thead>
      <tbody>
        {% comment %} 実データがあれば for で回してください。下はサンプル行。 {% endcomment %}
        {% if members %}
          {% for m in members %}
            <tr>
              <td>{{ m.member.user_id }}</td>
              <td>{{ m.member.user_name }}</td>
              <td>
                <div class="actions">
                  <a class="btn-check" href="{% url 'codemon:checklist_list' %}?user_id={{ m.member.user_id }}">
                    <img src="{% static 'codemon/images/button/checklist_detail_button.png' %}" alt="チェックリスト閲覧" style="height:40px;display:block;">
                  </a>
                  {% comment %} 教員ロールのメンバーは削除ボタンを表示しない {% endcomment %}
                  {% if m.role|default:'' != 'teacher' %}
                    <a class="btn-delete" href="{% url 'codemon:group_remove_member' group_id m.member.user_id %}">
                      <img src="{% static 'codemon/images/nav/delete.png' %}" alt="削除" style="height:40px;display:block;">
                    </a>
                  {% endif %}
                </div>
              </td>
            </tr>
          {% endfor %}
        {% else %}
          <tr><td colspan="3" class="no-data">メンバーが登録されていません</td></tr>
        {% endif %}
      </tbody>
    </table>
  </div>

  <!-- ページ専用: ヘッダー高さに合わせてカードの上マージンを調整 -->
  <script>
  (function(){
      function adjustCardMargin(){
          try{
              var header = document.querySelector('.top-tabs');
              var card = document.querySelector('.container');
              if(!header || !card) return;
              var rect = header.getBoundingClientRect();
              var bottom = rect.bottom || 0;
              var extra = 20;
              var pad = Math.ceil(bottom + extra);
              card.style.marginTop = pad + 'px';
          }catch(e){ console.error('adjustCardMargin error', e); }
      }

      document.addEventListener('DOMContentLoaded', adjustCardMargin);
      window.addEventListener('load', adjustCardMargin);
      window.addEventListener('resize', adjustCardMargin);
      setTimeout(adjustCardMargin, 300);
      setTimeout(adjustCardMargin, 1000);
  })();
  </script>
{% endblock %}