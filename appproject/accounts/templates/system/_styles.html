<!-- Font Awesome CDN -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
  /* Blocklyは外部スクリプトとして読み込む */
  :root { 
    --nav-height:56px; 
    --primary:#3fbcd9; 
    --bg:#f0f4f8; 
    --muted:#666; 
    --button-yellow:#FFD200;
    --error-red:#ff7675;
    --panel-bg:rgba(255, 255, 255, 0.95);
  }

  /* このページではスクロールを有効化 */
  body {
    overflow: visible !important;
    height: auto !important;
    background: var(--bg) !important;
  }

  /* ナビゲーション表示状態の制御 */
  .top-tabs {
    display: block; /* 常に表示 */
  }

  /* コンテンツ全体の配置 */
  .content-wrapper {
    display: flex;
    flex-direction: column; /* 縦並びに変更 */
    align-items: center;
    width: 100%;
    max-width: 1200px;
    margin: 0 auto;
    padding-top: 20px !important;
    padding-bottom: 40px;
    min-height: auto;
    overflow-y: visible;
    gap: 15px;
  }

  /* 上部のツールバー（横並び） */
  .toolbar {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    width: 100%;
    max-width: 900px;
    padding: 15px;
    background: var(--panel-bg);
    border-radius: 20px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.08);
    justify-content: center;
    align-items: center;
  }

  /* アクションボタングループ（実行、保存、戻る、進む） */
  .action-buttons {
    display: flex;
    gap: 8px;
    padding-right: 15px;
    border-right: 2px solid #e0e0e0;
  }

  /* ツールボタングループ */
  .tool-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
  }

  /* 共通ボタンスタイル */
  .toolbar button, .tool-btn {
    min-width: 50px;
    min-height: 50px;
    border-radius: 15px;
    border: none;
    cursor: pointer;
    font-size: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    position: relative;
  }

  .toolbar button:hover, .tool-btn:hover {
    transform: translateY(-3px) scale(1.05);
    box-shadow: 0 6px 20px rgba(0,0,0,0.15);
  }

  .toolbar button:active, .tool-btn:active {
    transform: translateY(2px) scale(0.98);
    box-shadow: 0 1px 4px rgba(0,0,0,0.1) !important;
  }

  /* 実行ボタン */
  #executeBtn {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 12px 24px;
    font-weight: bold;
  }

  #executeBtn:hover {
    background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
  }

  /* 保存ボタン */
  #saveBtn {
    background: var(--button-yellow);
    color: #333;
    padding: 12px 24px;
    font-weight: bold;
  }

  #saveBtn:hover {
    background: #ffd700;
  }

  /* 戻る・進むボタン */
  #undoBtn, #redoBtn {
    background: #f5f5f5;
    color: #666;
    width: 45px;
    height: 45px;
  }

  #undoBtn:hover, #redoBtn:hover {
    background: #e0e0e0;
    color: #333;
  }

  #undoBtn:disabled, #redoBtn:disabled {
    opacity: 0.4;
    cursor: not-allowed;
    transform: none !important;
  }

  /* ツールボタン */
  .tool-btn {
    background: white;
    color: var(--primary);
    width: 50px;
    height: 50px;
  }

  .tool-btn:hover {
    background: var(--primary);
    color: white;
  }

  .tool-btn.active {
    background: var(--primary);
    color: white;
    box-shadow: 0 0 0 3px rgba(63, 188, 217, 0.3);
  }

  /* レイヤー操作ボタン */
  #layerToFrontBtn, #layerForwardBtn, #layerBackwardBtn, #layerToBackBtn {
    background: linear-gradient(135deg, #a29bfe 0%, #6c5ce7 100%);
    color: white;
  }

  #layerToFrontBtn:hover, #layerForwardBtn:hover, #layerBackwardBtn:hover, #layerToBackBtn:hover {
    background: linear-gradient(135deg, #6c5ce7 0%, #5f4ddb 100%);
  }

  /* アイコンのホバーアニメーション */
  /* ルーレット - 回転 */
  #addRouletteBtn:hover i {
    animation: spin 1s linear infinite;
  }

  @keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }

  /* タイマー（砂時計） - ひっくり返る */
  #addTimerBtn:hover i {
    animation: flip 0.6s ease-in-out;
  }

  @keyframes flip {
    0%, 100% { transform: rotateX(0deg); }
    50% { transform: rotateX(180deg); }
  }

  /* フォーム - 揺れる */
  #formBtn:hover i {
    animation: wiggle 0.5s ease-in-out;
  }

  @keyframes wiggle {
    0%, 100% { transform: rotate(0deg); }
    25% { transform: rotate(-5deg); }
    75% { transform: rotate(5deg); }
  }

  /* 図形 - 回転 */
  #shapeBtn:hover i {
    animation: rotate360 0.6s ease-in-out;
  }

  @keyframes rotate360 {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }

  /* 画像 - パルス */
  #addImageBtn:hover i {
    animation: pulse 0.6s ease-in-out;
  }

  @keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.15); }
  }

  /* ボタン追加 - バウンス */
  #addButtonBtn:hover i {
    animation: bounceIcon 0.6s ease-in-out;
  }

  @keyframes bounceIcon {
    0%, 100% { transform: translateY(0); }
    25% { transform: translateY(-5px); }
    50% { transform: translateY(0); }
    75% { transform: translateY(-3px); }
  }

  /* 実行ボタン - 右にスライド */
  #executeBtn:hover i {
    animation: slideRight 0.5s ease-in-out;
  }

  @keyframes slideRight {
    0%, 100% { transform: translateX(0); }
    50% { transform: translateX(5px); }
  }

  /* 保存ボタン - 下にスライド */
  #saveBtn:hover i {
    animation: slideDown 0.5s ease-in-out;
  }

  @keyframes slideDown {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(3px); }
  }

  /* 戻るボタン - 反時計回りに回転 */
  #undoBtn:hover i {
    animation: rotateCounterClockwise 0.5s ease-in-out;
  }

  @keyframes rotateCounterClockwise {
    0%, 100% { transform: rotate(0deg); }
    50% { transform: rotate(-30deg); }
  }

  /* やり直すボタン - 時計回りに回転 */
  #redoBtn:hover i {
    animation: rotateClockwise 0.5s ease-in-out;
  }

  @keyframes rotateClockwise {
    0%, 100% { transform: rotate(0deg); }
    50% { transform: rotate(30deg); }
  }

  /* ドロップダウン付きボタン */
  .dropdown-btn {
    position: relative;
  }

  /* 右側のメインエリア */
  .main-area {
    flex: 1;
    display: flex;
    flex-direction: column;
    width: 100%;
    max-width: 900px;
  }

    /* フォーム用ドロップダウン */
    .form-dropdown {
      position: relative;
      display: inline-block;
    }
    .form-dropdown .dropdown-menu {
      position: absolute;
      top: calc(100% + 8px);
      left: 0;
      background: var(--panel-bg);
      border: none;
      border-radius: 15px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
      padding: 10px;
      min-width: 200px;
      z-index: 1200;
      display: none;
    }
    .form-dropdown .dropdown-menu.show {
      display: block;
      animation: slideDown 0.2s ease;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .form-dropdown .dropdown-menu button {
      display: flex;
      align-items: center;
      gap: 10px;
      width: 100%;
      text-align: left;
      padding: 10px 12px;
      margin: 4px 0;
      background: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 14px;
    }
    .form-dropdown .dropdown-menu button:hover {
      background: var(--primary);
      color: white;
      transform: translateX(5px);
    }

    /* checkbox / radio create panel (共通レイアウト) */
    .create-options-panel {
      position: absolute;
      top: calc(100% + 8px);
      left: 190px;
      background: var(--panel-bg);
      border: none;
      border-radius: 15px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.15);
      padding: 15px;
      z-index: 1300;
      min-width: 240px;
      display: none;
    }
    .create-options-panel.show { 
      display: block;
      animation: slideDown 0.2s ease;
    }
    .create-options-panel label { display:block; margin-bottom:8px; color:#333; font-size:14px; font-weight:600; }
    .create-options-panel input[type="text"],
    .create-options-panel input[type="number"] { 
      width: 100%;
      padding:8px 10px; 
      border-radius:10px;
      border:2px solid #e0e0e0;
      font-size:14px;
      transition: border-color 0.2s;
    }
    .create-options-panel input[type="text"]:focus,
    .create-options-panel input[type="number"]:focus {
      outline: none;
      border-color: var(--primary);
    }
    .create-options-panel .panel-actions { 
      margin-top:15px; 
      display:flex; 
      gap:10px; 
      justify-content:flex-end; 
    }
    .create-options-panel .panel-actions button {
      padding: 8px 16px;
      border-radius: 10px;
      border: none;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s;
      white-space: nowrap;
      min-width: 80px;
    }
    .create-options-panel .panel-actions button:first-child {
      background: #f5f5f5;
      color: #666;
    }
    .create-options-panel .panel-actions button:first-child:hover {
      background: #e0e0e0;
    }
    .create-options-panel .panel-actions button:last-child {
      background: var(--primary);
      color: white;
    }
    .create-options-panel .panel-actions button:last-child:hover {
      background: #2fc9ea;
    }

    .shortcut-bar {
      width: 860px;
      display: flex;
      justify-content: flex-start;
      align-items: center;
      margin-bottom: 16px;
      margin-top: 0;
    }
    .shortcut-bar button {
      margin-right: 10px;
      font-size: 18px;
      padding: 6px 18px;
      border-radius: 4px;
      border: 1px solid #bbb;
      background: #f5f5f5;
      cursor: pointer;
      transition: background 0.2s;
    }
    .shortcut-bar button:hover {
      background: #e0e0e0;
    }
    .shortcut-bar .shortcut-label {
      font-size: 14px;
      color: #555;
      margin-right: 20px;
    }

    /* 既存の青い保存スタイル（参照用） */
    .shortcut-save {
      padding: 10px 18px;
      font-size: 16px;
      border-radius: 10px;
      border: 1px solid rgba(10,59,110,0.08);
      background: linear-gradient(180deg,#cfe7ff,#b6d9ff);
      color: #0a3b6e;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 6px 16px rgba(10,59,110,0.06);
      margin-left: 6px;
      transition: transform .12s ease, box-shadow .12s ease;
    }
    .shortcut-save:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 24px rgba(10,59,110,0.10);
    }
    .shortcut-save[aria-disabled="true"]{
      opacity: 0.7;
      cursor: not-allowed;
      box-shadow: none;
      transform: none;
    }

    /* ご希望の緑スタイル（優先的に適用されるようセレクタを具体化） */
    .shortcut-bar .shortcut-btns #saveBtn {
      font-size: 18px;
      margin-left: 8px;
      background: #28a745;
      color: #fff;
      border: none;
      border-radius: 4px;
      padding: 4px 14px;
      cursor: pointer;
    }
    .shortcut-bar .shortcut-btns #saveBtn:hover {
      background: #1e7e34;
    }

    /* 全削除ボタンのスタイル */
    .shortcut-bar .shortcut-btns #clearAllBtn {
      font-size: 18px;
      margin-left: 8px;
      background: #dc3545;
      color: #fff;
      border: none;
      border-radius: 4px;
      padding: 4px 16px;
      cursor: pointer;
    }
    .shortcut-bar .shortcut-btns #clearAllBtn:hover {
      background: #c82333;
    }

    /* Run/実行 ボタンの見た目を統一 */
    .shortcut-bar .shortcut-btns #executeBtn {
      font-size: 18px;
      margin-left: 10px;
      background: #007bff;
      color: #fff;
      border: none;
      border-radius: 4px;
      padding: 4px 16px;
      cursor: pointer;
    }
    .shortcut-bar .shortcut-btns #executeBtn:hover {
      background: #0056b3;
    }
    #slideArea {
      width: 100%;
      height: 500px;
      border-radius: 20px;
      background: var(--panel-bg);
      box-shadow: 0 4px 15px rgba(0,0,0,0.08);
      position: relative;
      overflow: hidden;
      margin: 0 auto;
      display: block;
    }

    .input-container {
      position: absolute;
      display: flex;
      align-items: center;
      min-width: 180px;
      min-height: 40px;
      cursor: grab;
      box-sizing: border-box;
      left: 0;
      top: 0;
    }

    .input-container.grabbing { cursor: grabbing; }

    .input-label {
      margin-right: 5px;
      white-space: nowrap;
      padding: 2px 4px;
      border: 1px dashed transparent;
      min-width: 40px;
    }
    .input-label[contenteditable="true"]:focus {
      outline: none;
      border: 1px dashed #999;
      background: #f0f0f0;
    }

    .input-box {
      resize: like;
      overflow: auto;
      min-width: 120px;
      min-height: 40px;
      padding: 5px;
      box-sizing: border-box;
    }

    /* datetime-local input のカスタムスタイル */
    input[type="datetime-local"] {
      border: 2px solid #3fbcd9;
      border-radius: 12px;
      background: linear-gradient(135deg, #ffffff 0%, #f0f4f8 100%);
      color: #333;
      font-family: inherit;
      transition: all 0.3s ease;
      box-shadow: 0 2px 8px rgba(63, 188, 217, 0.2);
    }

    input[type="datetime-local"]:hover {
      border-color: #2da3c0;
      box-shadow: 0 4px 12px rgba(63, 188, 217, 0.3);
      transform: translateY(-1px);
    }

    input[type="datetime-local"]:focus {
      outline: none;
      border-color: #2da3c0;
      box-shadow: 0 0 0 3px rgba(63, 188, 217, 0.2), 0 4px 12px rgba(63, 188, 217, 0.3);
      background: #ffffff;
    }

    /* カレンダーアイコンのカスタマイズ (WebKit) - Font Awesomeカレンダーアイコン */
    input[type="datetime-local"]::-webkit-calendar-picker-indicator {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 448 512'%3E%3Cpath fill='%23ffffff' d='M96 32V64H48C21.5 64 0 85.5 0 112v48H448V112c0-26.5-21.5-48-48-48H352V32c0-17.7-14.3-32-32-32s-32 14.3-32 32V64H160V32c0-17.7-14.3-32-32-32S96 14.3 96 32zM448 192H0V464c0 26.5 21.5 48 48 48H400c26.5 0 48-21.5 48-48V192zM80 272c0-8.8 7.2-16 16-16h32c8.8 0 16 7.2 16 16v32c0 8.8-7.2 16-16 16H96c-8.8 0-16-7.2-16-16V272zm80 0c0-8.8 7.2-16 16-16h32c8.8 0 16 7.2 16 16v32c0 8.8-7.2 16-16 16H176c-8.8 0-16-7.2-16-16V272zm80 0c0-8.8 7.2-16 16-16h32c8.8 0 16 7.2 16 16v32c0 8.8-7.2 16-16 16H256c-8.8 0-16-7.2-16-16V272zM80 368c0-8.8 7.2-16 16-16h32c8.8 0 16 7.2 16 16v32c0 8.8-7.2 16-16 16H96c-8.8 0-16-7.2-16-16V368zm80 0c0-8.8 7.2-16 16-16h32c8.8 0 16 7.2 16 16v32c0 8.8-7.2 16-16 16H176c-8.8 0-16-7.2-16-16V368zm80 0c0-8.8 7.2-16 16-16h32c8.8 0 16 7.2 16 16v32c0 8.8-7.2 16-16 16H256c-8.8 0-16-7.2-16-16V368z'/%3E%3C/svg%3E");
      background-size: 18px 18px;
      background-repeat: no-repeat;
      background-position: center;
      background-color: #3fbcd9;
      border-radius: 8px;
      padding: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
      width: 32px;
      height: 32px;
    }

    input[type="datetime-local"]::-webkit-calendar-picker-indicator:hover {
      background-color: #2da3c0;
      transform: scale(1.1);
    }

    input[type="datetime-local"]::-webkit-datetime-edit-fields-wrapper {
      padding: 4px 8px;
    }

    input[type="datetime-local"]::-webkit-datetime-edit {
      color: #333;
      font-weight: 500;
    }

    input[type="datetime-local"]::-webkit-datetime-edit-text {
      color: #666;
      padding: 0 4px;
    }

    input[type="datetime-local"]::-webkit-datetime-edit-month-field,
    input[type="datetime-local"]::-webkit-datetime-edit-day-field,
    input[type="datetime-local"]::-webkit-datetime-edit-year-field,
    input[type="datetime-local"]::-webkit-datetime-edit-hour-field,
    input[type="datetime-local"]::-webkit-datetime-edit-minute-field {
      background: rgba(63, 188, 217, 0.1);
      border-radius: 4px;
      padding: 2px 4px;
      color: #333;
      font-weight: 600;
    }

    input[type="datetime-local"]::-webkit-datetime-edit-month-field:focus,
    input[type="datetime-local"]::-webkit-datetime-edit-day-field:focus,
    input[type="datetime-local"]::-webkit-datetime-edit-year-field:focus,
    input[type="datetime-local"]::-webkit-datetime-edit-hour-field:focus,
    input[type="datetime-local"]::-webkit-datetime-edit-minute-field:focus {
      background: rgba(63, 188, 217, 0.2);
      color: #2da3c0;
    }

    /* checkbox / radio group: 背景・枠・影を完全に非表示 */
    .checkbox-group,
    .radio-group {
      position: absolute;
      min-width: 140px;
      background: transparent !important; /* 背景を透明化 */
      border: none !important;            /* 枠を非表示 */
      box-shadow: none !important;        /* 影を消す */
      padding: 0;                          /* 行間は個別に調整 */
      border-radius: 0;                    /* 角丸を消す */
      box-sizing: border-box;
      cursor: grab;
    }
    .checkbox-group.grabbing, .radio-group.grabbing { cursor: grabbing; }
    .checkbox-row, .radio-row {
      display:flex;
      align-items:center;
      gap:8px;
      padding:4px 0; /* 行間のみ残す */
      background: transparent;
    }
    .checkbox-row input[type="checkbox"],
    .radio-row input[type="radio"] {
      width:18px;
      height:18px;
      background: transparent; /* ブラウザ既定の背景を邪魔しないように */
      appearance: auto;
    }
    .checkbox-label, .radio-label {
      flex:1;
      padding: 0 6px;
      border-radius:0;
      background: transparent; /* ラベル背景も透明化 */
    }
    .checkbox-label[contenteditable="true"]:focus,
    .radio-label[contenteditable="true"]:focus {
      outline: none;
      background: rgba(0,0,0,0.03);
      border: none;
    }

    .draggable-btn {
      position: absolute;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: grab;
      min-width: 60px;
      min-height: 30px;
      box-sizing: border-box;
    }
    .draggable-btn.grabbing { cursor: grabbing; }
    .draggable-btn:hover {
      filter: brightness(0.9);
    }
    /* drag handle */
    .drag-handle {
      position: absolute;
      left: -10px;
      top: -10px;
      width: 20px;
      height: 20px;
      border-radius: 4px;
      background: rgba(0,0,0,0.06);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:12px;
      color: rgba(0,0,0,0.6);
      cursor: grab;
      user-select: none;
      box-shadow: 0 1px 3px rgba(0,0,0,0.08);
      z-index: 1000;
    }
    .drag-handle:active { cursor: grabbing; }
    .drag-handle.hidden { display:none; }

    /* ゴミ箱をスライドの右下に配置 */
    #slideArea #trash {
      position: absolute;
      bottom: 20px;
      right: 20px;
      width: 70px;
      height: 70px;
      background: #e0e0e0;
      color: #888;
      border-radius: 15px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      cursor: pointer;
      z-index: 9999;
      transition: all 0.3s ease;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      border: 2px solid #ccc;
      user-select: none;
    }
    
    #slideArea #trash i {
      transition: transform 0.3s ease;
    }
    
    #slideArea #trash:hover i,
    #slideArea #trash.dragover i {
      transform: rotateZ(-10deg) translateY(-3px);
    }
    
    #slideArea #trash:hover {
      background: #d5d5d5;
      transform: scale(1.05);
      box-shadow: 0 4px 12px rgba(0,0,0,0.12);
    }
    
    #slideArea #trash.dragover {
      background: #ffebee;
      border-color: #ff7675;
      color: #ff7675;
      transform: scale(1.1);
      box-shadow: 0 6px 16px rgba(255, 118, 117, 0.3);
    }

    /* 追記用 CSS: 選択矩形とテキストボックス */
    .textarea-selection {
      position: absolute;
      border: 2px dashed rgba(25,118,210,0.9);
      background: rgba(25,118,210,0.07);
      z-index: 1500;
      pointer-events: none;
      box-sizing:border-box;
    }

    /* 非選択時はコンテナ枠を非表示にする（要望） */
    .text-input-container {
      position: absolute;
      box-sizing: border-box;
      z-index: 1200;
      display: block;
      min-width: 40px;
      min-height: 24px;
      border: none;           /* 非選択時は枠を消す */
      background: transparent;
      cursor: grab;           /* クリックしてドラッグ可能 */
      overflow: auto;
      /* コンテナ自体でリサイズさせる（内側の要素はリサイズ不可にする） */
      resize: both;
    }
    .text-input-container.grabbing { cursor: grabbing; }

    /* テキスト自体はコンテナに合わせて伸縮し、個別のリサイズハンドルは持たない */
    .text-input {
      width: 100%;
      height: 100%;
      padding: 6px 8px;
      box-sizing: border-box;
      /* 内側はリサイズを無効化して、コンテナのリサイズだけにする */
      resize: none !important;
      overflow: auto;
      outline: none;
      border: none;           /* 非選択時は枠を消す */
      background: transparent; /* 背景を透明化（白をなくす） */
      font-size: 14px;
      line-height: 1.4;
      min-height: 20px;
      min-width: 20px;
      display: block;
    }

    /* 編集（フォーカス）時にのみ枠／影を表示（セレクタ修正済み） */
    .text-input-container:focus-within {
      border: 1px dashed rgba(0,0,0,0.12);
      background: transparent; /* フォーカス時も白背景を入れない */
      box-shadow: 0 6px 18px rgba(25,118,210,0.04);
      cursor: text;
    }
    .text-input-container:focus-within .text-input {
      border: 1px solid rgba(0,0,0,0.12);
      background: transparent; /* フォーカス時も白背景を入れない */
    }

    /* 表示用のリサイズ中クラス（視覚のヒント、任意） */
    .text-input-container.resizing {
      box-shadow: 0 0 0 2px rgba(25,118,210,0.06) inset;
      pointer-events: auto;
      cursor: nwse-resize;
    }

    /* タイマー要素のスタイル */
    .timer-container {
      position: absolute;
      background: linear-gradient(180deg, #fff5e6, #ffe8cc);
      border: 3px solid var(--button-yellow);
      border-radius: 20px;
      padding: 15px;
      box-shadow: 0 4px 15px rgba(255, 210, 0, 0.3);
      min-width: 220px;
      cursor: grab;
      box-sizing: border-box;
      transition: all 0.2s ease;
    }
    .timer-container:hover {
      box-shadow: 0 6px 20px rgba(255, 210, 0, 0.4);
      transform: translateY(-2px);
    }
    .timer-container.grabbing { cursor: grabbing; }
    
    .timer-settings-btn {
      display: block;
      margin: 0 auto 10px auto;
      padding: 6px 14px;
      font-size: 12px;
      border: none;
      border-radius: 10px;
      background: white;
      color: #666;
      cursor: pointer;
      transition: all 0.2s;
      font-weight: 600;
    }
    .timer-settings-btn:hover {
      background: #f5f5f5;
      transform: scale(1.05);
    }
    
    .timer-display {
      font-size: 32px;
      font-weight: 700;
      color: #333;
      text-align: center;
      font-family: 'Courier New', monospace;
      margin-bottom: 12px;
      user-select: none;
    }
    
    .timer-controls {
      display: flex;
      gap: 8px;
      justify-content: center;
    }
    .timer-btn {
      padding: 8px 16px;
      font-size: 13px;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 700;
      transition: all 0.2s;
    }
    .timer-btn.start {
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: white;
    }
    .timer-btn.start:hover {
      transform: scale(1.1);
      box-shadow: 0 4px 12px rgba(34, 197, 94, 0.4);
    }
    .timer-btn.pause {
      background: linear-gradient(135deg, #f97316, #ea580c);
      color: white;
    }
    .timer-btn.pause:hover {
      transform: scale(1.1);
      box-shadow: 0 4px 12px rgba(249, 115, 22, 0.4);
    }
    .timer-btn.reset {
      background: linear-gradient(135deg, #ef4444, #dc2626);
      color: white;
    }
    .timer-btn.reset:hover {
      transform: scale(1.1);
      box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
    }

    /* プレビュー用オーバーレイ（より画面全体に表示） */
    .preview-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.65);
      display: flex;
      flex-direction: column;
      z-index: 9999;
      align-items: stretch;
      justify-content: center;
      padding: 8px;                 /* 少なめの余白でより全画面に見せる */
      box-sizing:border-box;
    }

    /* 図形要素の共通スタイル */
    .shape-element {
      position: absolute;
      border: 3px solid var(--primary);
      box-sizing: border-box;
      cursor: move;
      transition: all 0.2s ease;
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    }

    .shape-element:hover {
      box-shadow: 0 5px 18px rgba(0,0,0,0.15);
      transform: translateY(-2px);
    }

    .shape-element.selected {
      border-color: var(--button-yellow);
      box-shadow: 0 0 0 4px rgba(255, 210, 0, 0.3);
    }

    .shape-rectangle {
      background: transparent;
    }

    .shape-circle {
      border-radius: 50%;
      background: transparent;
    }

    .shape-triangle {
      width: 0;
      height: 0;
      border-left: 50px solid transparent;
      border-right: 50px solid transparent;
      border-bottom: 86.6px solid #333;
      border-top: none;
      background: transparent;
    }

    .shape-line {
      height: 2px;
      background: #333;
      border: none;
      transform-origin: left center;
    }

    .shape-arrow {
      display: flex;
      align-items: center;
      border: none;
    }

    .shape-arrow::before {
      content: '';
      flex: 1;
      height: 2px;
      background: #333;
    }

    .shape-arrow::after {
      content: '';
      width: 0;
      height: 0;
      border-left: 10px solid #333;
      border-top: 6px solid transparent;
      border-bottom: 6px solid transparent;
    }

    /* 図形設定パネル */
    .shape-settings-panel {
      position: absolute;
      background: var(--panel-bg);
      border: none;
      border-radius: 20px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.2);
      padding: 20px;
      z-index: 10000;
      min-width: 300px;
      display: none;
    }

    .shape-settings-panel.show {
      display: block;
      animation: slideDown 0.2s ease;
    }

    .shape-settings-panel .setting-row {
      margin-bottom: 16px;
    }

    .shape-settings-panel label {
      display: block;
      margin-bottom: 8px;
      font-weight: 700;
      color: #333;
      font-size: 14px;
    }

    .shape-settings-panel input[type="number"],
    .shape-settings-panel input[type="color"] {
      width: 100%;
      padding: 10px 12px;
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      box-sizing: border-box;
      transition: border-color 0.2s;
    }

    .shape-settings-panel input[type="number"]:focus {
      outline: none;
      border-color: var(--primary);
    }

    .shape-settings-panel .color-picker-wrapper {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .shape-settings-panel input[type="color"] {
      width: 70px;
      height: 40px;
      cursor: pointer;
      border-radius: 10px;
    }

    .shape-settings-panel .panel-actions {
      margin-top: 20px;
      display: flex;
      gap: 10px;
      justify-content: flex-end;
    }

    .shape-settings-panel button {
      padding: 10px 20px;
      border-radius: 12px;
      border: none;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.2s;
    }

    .shape-settings-panel button.primary {
      background: var(--primary);
      color: white;
    }

    .shape-settings-panel button.primary:hover {
      background: #2fc9ea;
      transform: translateY(-2px);
    }

    .shape-settings-panel button:not(.primary) {
      background: #f5f5f5;
      color: #666;
    }

    .shape-settings-panel button:not(.primary):hover {
      background: #e0e0e0;
    }

    /* 画像要素 */
    .image-element {
      position: absolute;
      cursor: move;
      border: 3px solid transparent;
      box-sizing: border-box;
      border-radius: 12px;
      overflow: hidden;
      transition: all 0.2s ease;
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    }

    .image-element:hover {
      border-color: var(--primary);
      box-shadow: 0 5px 18px rgba(0,0,0,0.15);
      transform: translateY(-2px);
    }

    .image-element.selected {
      border-color: var(--button-yellow);
      box-shadow: 0 0 0 4px rgba(255, 210, 0, 0.3);
    }

    .image-element img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      display: block;
    }

    /* 画像設定パネル */
    .image-settings-panel {
      position: absolute;
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 8px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.15);
      padding: 16px;
      z-index: 10000;
      min-width: 280px;
      display: none;
    }

    .image-settings-panel.show {
      display: block;
    }

    .image-settings-panel .setting-row {
      margin-bottom: 12px;
    }

    .image-settings-panel label {
      display: block;
      margin-bottom: 6px;
      font-weight: 600;
      color: #333;
      font-size: 13px;
    }

    .image-settings-panel input[type="number"] {
      width: 100%;
      padding: 6px 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      box-sizing: border-box;
    }

    .image-settings-panel .panel-actions {
      margin-top: 16px;
      display: flex;
      gap: 8px;
      justify-content: flex-end;
    }

    .image-settings-panel button {
      padding: 8px 16px;
      border-radius: 6px;
      border: 1px solid #ddd;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s;
    }

    .image-settings-panel button.primary {
      background: #1976d2;
      color: white;
      border-color: #1976d2;
    }

    .image-settings-panel button.primary:hover {
      background: #1565c0;
    }

    .image-settings-panel button:not(.primary) {
      background: #fff;
    }

    .image-settings-panel button:not(.primary):hover {
      background: #f5f5f5;
    }
    .preview-header {
      height: 48px;
      display:flex;
      align-items:center;
      justify-content:flex-start;
      gap:8px;
      z-index: 10010;
    }
    .preview-close {
      background:#fff;
      border:1px solid #ccc;
      padding:6px 12px;
      border-radius:6px;
      cursor:pointer;
      font-weight:600;
    }
    .preview-area {
      flex:1;
      background:transparent;
      border-radius:6px;
      overflow:hidden;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:4px;                  /* 軽い内側余白 */
      box-sizing:border-box;
    }
    /* プレビューでほぼ全画面表示にする（max 制限を除去） */
    #previewSlideArea {
      width: calc(100vw - 16px);    /* 左右に小さな余白を残す */
      height: calc(100vh - 72px);   /* ヘッダ分と上下に余白を残す */
      max-width: none;
      max-height: none;
      border: 2px dashed #666;
      position:relative;
      background:#fff;
      box-sizing:border-box;
      border-radius:6px;
      overflow:auto;
    }

    /* カラーメニュー（右クリック色変更） */
    .text-color-menu {
      position: fixed;
      background: var(--panel-bg);
      border: none;
      border-radius: 15px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.2);
      padding: 16px;
      z-index: 10000;
      min-width: 240px;
      animation: slideDown 0.2s ease;
    }

    .text-color-menu label {
      display: block;
      margin-bottom: 8px;
      font-size: 14px;
      font-weight: 600;
      color: #333;
    }

    .text-color-menu input[type="color"] {
      cursor: pointer;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      transition: border-color 0.2s;
    }

    .text-color-menu input[type="color"]:focus {
      outline: none;
      border-color: var(--primary);
    }

    .text-color-menu button {
      padding: 8px 16px;
      border-radius: 10px;
      border: none;
      cursor: pointer;
      font-size: 13px;
      font-weight: 600;
      transition: all 0.2s;
    }

    .text-color-menu button#colorMenuCancel {
      background: #f5f5f5;
      color: #666;
    }

    .text-color-menu button#colorMenuCancel:hover {
      background: #e0e0e0;
    }

    .text-color-menu button#colorMenuApply {
      background: var(--primary);
      color: white;
    }

    .text-color-menu button#colorMenuApply:hover {
      background: #2fc9ea;
      transform: translateY(-2px);
    }

    /* カスタムconfirmダイアログ */
    .custom-confirm-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 100000;
      animation: fadeIn 0.2s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .custom-confirm-dialog {
      background: var(--panel-bg);
      border-radius: 20px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
      max-width: 400px;
      width: 90%;
      overflow: hidden;
      animation: slideUp 0.3s ease;
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .custom-confirm-header {
      background: var(--primary);
      color: white;
      padding: 20px;
      text-align: center;
      font-size: 18px;
      font-weight: 700;
    }

    .custom-confirm-body {
      padding: 30px 25px;
      text-align: center;
      font-size: 15px;
      line-height: 1.6;
      color: #333;
      white-space: pre-line;
    }

    .custom-confirm-buttons {
      display: flex;
      gap: 12px;
      padding: 0 25px 25px 25px;
      justify-content: center;
    }

    .custom-confirm-btn {
      flex: 1;
      padding: 12px 24px;
      border: none;
      border-radius: 12px;
      font-size: 15px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s ease;
      max-width: 150px;
    }

    .custom-confirm-btn.cancel {
      background: #f5f5f5;
      color: #666;
    }

    .custom-confirm-btn.cancel:hover {
      background: #e0e0e0;
      transform: translateY(-2px);
    }

    .custom-confirm-btn.confirm {
      background: var(--button-yellow);
      color: #333;
    }

    .custom-confirm-btn.confirm:hover {
      background: #ffd700;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(255, 210, 0, 0.4);
    }

    .custom-confirm-btn.danger {
      background: var(--error-red);
      color: white;
    }

    .custom-confirm-btn.danger:hover {
      background: #ff5252;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(255, 118, 117, 0.4);
    }

    .custom-confirm-btn:active {
      transform: translateY(0) scale(0.98);
    }

    /* alert用：キャンセルボタンを非表示 */
    .custom-confirm-buttons:has(.cancel:empty) .cancel {
      display: none;
    }

    /* ショートカットバー */
    .shortcut-bar {
      width: 100%;
      display: flex;
      justify-content: flex-start;
      align-items: center;
      margin-bottom: 10px;
    }

    @media (max-width:980px){
      .content-wrapper {
        flex-direction: column;
        align-items: center;
      }
      .button-bar {
        width: 100%;
        max-width: 860px;
      }
      .main-area, .shortcut-bar, #slideArea { width: 92%; max-width:860px; }
      #previewSlideArea { width: calc(100vw - 8px); height: calc(100vh - 72px); }
      .create-options-panel { left: 8px; top: auto; }
    }
  </style>
