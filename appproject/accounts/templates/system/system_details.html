{% extends 'base.html' %}
{% load static %}

{% block background_frame %}
<img src="{% static 'codemon/images/frames/bg_frame_blue.png' %}" 
     alt="" 
     class="bg-frame"
     onerror="this.style.display='none';">
{% endblock %}

{% block title %}システム詳細 - Codemon{% endblock %}

{% block extra_css %}
<style>
  /* ナビゲーション表示状態の制御 */
  .top-tabs {
    display: block;
  }

  main {
    margin: 100px auto 20px auto;
    max-width: 980px;
    box-sizing: border-box;
  }

  h1 { text-align:center; margin-top:8px; }
  h1 { text-align:center; margin-top:8px; }
  .card {
    background:#fff; border-radius:10px; padding:18px; box-shadow:0 6px 18px rgba(10,10,10,0.04);
    border:1px solid #eef2f6; margin:18px auto; max-width:820px;
  }

  /* 追加: フォームとボタン領域のスタイル */
  form.system-form{ display:flex; flex-direction:column; gap:12px; }
  .form-row{ display:flex; flex-direction:column; gap:6px; }
  label{ font-weight:600; font-size:14px; color:#333; }
  input[type="text"], textarea{
    padding:10px; border-radius:8px; border:1px solid #dfe6ef; background:#f7f9fc; color:#333;
    font-size:14px; resize:none; overflow-y:auto;
  }
  textarea {
    height: 100px;
    min-height: 100px;
    max-height: 100px;
  }
  input[disabled], textarea[disabled]{
    opacity:1; /* disabledでも薄くしない */
    cursor:default;
    background:#fafbff;
  }

  .card-actions{ display:flex; justify-content:flex-end; gap:10px; margin-top:18px; }
  .btn{
    padding:8px 12px; border-radius:8px; border:1px solid #d0d7de; background:#fff; cursor:pointer; font-size:14px;
  }
  .btn.primary{ 
    background:transparent; 
    border:none; 
    padding:0; 
    cursor:pointer;
    width: auto;
    height: 40px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
  }
  .btn.primary img {
    height: 100%;
    width: auto;
    object-fit: contain;
  }
  .btn.primary:hover {
    opacity: 0.8;
  }
  .btn.warn{ 
    background:transparent; 
    border:none; 
    padding:0; 
    cursor:pointer;
    width: auto;
    height: 40px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
  }
  .btn.warn img {
    height: 100%;
    width: auto;
    object-fit: contain;
  }
  .btn.warn:hover {
    opacity: 0.8;
  }
  .btn.ghost{ 
    background:transparent; 
    border:none; 
    padding:0; 
    cursor:pointer;
    width: auto;
    height: 40px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
  }
  .btn.ghost img {
    height: 100%;
    width: auto;
    object-fit: contain;
  }
  .btn.ghost:hover {
    opacity: 0.8;
  }
</style>
{% endblock %}

{% block content %}
<main>
    <h1>システム詳細</h1>

    <div class="card" role="region" aria-label="システム詳細内容">
      <!-- システム名・概要を表示するフォーム -->
      <form class="system-form" aria-label="システム情報" onsubmit="return false;">
        <div class="form-row">
          <label for="system-name">システム名</label>
          <input id="system-name" name="name" type="text" value="{{ system_name }}" disabled aria-disabled="true" />
        </div>

        <div class="form-row">
          <label for="system-summary">システムの詳細</label>
          <textarea id="system-summary" name="summary" rows="6" disabled aria-disabled="true">{{ system_description }}</textarea>
        </div>

        <div class="form-row">
          <label for="created-at">作成日</label>
          <input id="created-at" name="created_at" type="text" value="{{ created_at|date:'Y年n月j日 H:i' }}" disabled aria-disabled="true" />
        </div>

        <!-- 下部の操作ボタン（表示） -->
        <div class="card-actions" role="group" aria-label="操作">
          <button type="button" class="btn ghost" id="btn-back" title="一覧に戻る">
            <img src="{% static 'codemon/images/buttons/back.png' %}" alt="戻る">
          </button>
          <button type="button" class="btn warn" id="btn-delete" title="削除">
            <img src="{% static 'codemon/images/buttons/delete.png' %}" alt="削除">
          </button>
          <button type="button" class="btn primary" id="btn-edit" title="編集">
            <img src="{% static 'codemon/images/buttons/edit.png' %}" alt="編集">
          </button>
        </div>
      </form>
    </div>
</main>

<script>
    // ナビタブ見た目切替（既存挙動） + アルゴリズムタブで遷移先を block_choice.html に変更
    document.querySelectorAll('.nav-tab').forEach(tab=>{
      tab.addEventListener('click', function(e){
        e.preventDefault();
        document.querySelectorAll('.nav-tab').forEach(t=>{
          t.classList.remove('active');
          t.setAttribute('aria-pressed','false');
        });
        this.classList.add('active');
        this.setAttribute('aria-pressed','true');

        // システムタブ: システム選択画面へ遷移
        if (this.id === 'tab-system') {
          window.location.href = '/accounts/system/choice/';
          return;
        }

        // 変更: アルゴリズムタブ押下で block/choiceへ遷移
        if (this.id === 'tab-algorithm') {
          window.location.href = '/accounts/block/choice';
          return;
        }

        // 他タブは現在遷移先なし（見た目切替のみ）
      });
    });

    // 戻るボタンは前の画面 system_list.html に遷移
    document.getElementById('btn-back').addEventListener('click', function(){
      window.location.href = '/accounts/system/list/';
    });

    // 編集ボタン: システムIDをパラメータとしてindex.htmlへ遷移
    document.getElementById('btn-edit').addEventListener('click', function(){
      const systemId = '{{ system_id }}';
      window.location.href = '/accounts/system/?id=' + systemId;
    });

    // 削除ボタン: システムIDをパラメータとしてsystem_delete.htmlへ遷移
    document.getElementById('btn-delete').addEventListener('click', function(){
      const systemId = '{{ system_id }}';
      window.location.href = '/accounts/system/delete/?id=' + systemId;
    });
  </script>

{% endblock %}