{% extends "base.html" %}
{% load static %}

{% block body_class %} class="no-scroll"{% endblock %}

{% block background_frame %}
  <img src="{% static 'codemon/images/frames/bg_frame_yellow.png' %}" 
       alt="" 
       class="bg-frame frame-yellow"
       onerror="this.style.display='none';">
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'codemon/css/chat_student.css' %}?v=4">
<style>
/* ここでチャット画面のサイズと位置を直接カスタマイズできます */
:root {
  /* デスクトップ中央配置(カード風) */
  --chat-max-width: 800px;
  --chat-max-height: 70vh;
  --chat-margin: 20px auto;
  --chat-border-radius: 12px;
  --chat-box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  --chat-position: fixed;
  --chat-position-x: 50px;
  --chat-position-y: 130px;
  --chat-margin: 0;
  */
}
</style>
{% endblock %}

{% block content %}
<div class="chat-container student-chat">
  <!-- ヘッダー部分 -->
  <div class="chat-header">
    <div class="header-left">
      <button class="btn-back" onclick="history.back()">←</button>
      <h1 class="chat-title">チャット</h1>
    </div>
    <div class="header-right">
      <a href="{% url 'codemon:student_icon_settings' %}" class="btn-icon-settings">⚙</a>
    </div>
  </div>

  <!-- メインコンテンツ -->
  <div class="chat-content">
    <!-- チャットリスト -->
    <div class="chat-list">
      <!-- チャットリストがここに動的に表示されます -->
    </div>

    <!-- チャット詳細画面（詳細表示時） -->
    <div class="chat-detail hidden">
      <div class="chat-detail-header">
        <button class="btn-back-detail">←</button>
        <h2 class="chat-detail-title">チャット</h2>
        <div class="header-actions"></div>
      </div>

      <div class="messages-container">
        <!-- メッセージがここに動的に表示されます -->
      </div>

      <!-- 点数表示エリア -->
      <div class="grade-section">
        <!-- 点数がここに動的に表示されます -->
      </div>
    </div>
  </div>

  <!-- フッター入力部分 -->
  <div class="chat-footer">
    <div class="input-area">
      <button class="btn-attach" title="ファイル投函">
        <svg class="icon-attach" viewBox="0 0 24 24">
          <path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96z"/>
        </svg>
      </button>
      <button class="btn-image" title="画像投函">
        <svg class="icon-image" viewBox="0 0 24 24">
          <path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/>
        </svg>
      </button>
      <input type="text" class="message-input" placeholder="メッセージを入力...">
      <button class="btn-send">
        <svg class="icon-send" viewBox="0 0 24 24">
          <path d="M16.6915026,12.4744748 L3.50612381,13.2599618 C3.19218622,13.2599618 3.03521743,13.4170592 3.03521743,13.5741566 L1.15159189,20.0151496 C0.8376543,20.8006365 0.99,21.89 1.77946707,22.52 C2.41,22.99 3.50612381,23.1 4.13399899,22.8429026 L21.714504,14.0454487 C22.6563168,13.5741566 23.1272231,12.6315722 22.9702544,11.6889879 C22.9702544,11.6889879 22.9702544,11.5318905 22.9702544,11.4748131 L4.13399899,1.16346272 C3.34915502,0.9 2.40734225,1.00636533 1.77946707,1.4776575 C0.994623095,2.10604706 0.837654326,3.0486314 1.15159189,3.99721575 L3.03521743,10.4382088 C3.03521743,10.5953061 3.34915502,10.7524035 3.50612381,10.7524035 L16.6915026,11.5318905 C16.6915026,11.5318905 17.1624089,11.5318905 17.1624089,11.0606983 L17.1624089,12.0032827 C17.1624089,12.4744748 16.6915026,12.4744748 16.6915026,12.4744748 Z"/>
        </svg>
      </button>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  document.querySelectorAll('.btn-attach').forEach(btn => {
    btn.addEventListener('click', () => {
      // ファイル投函画面へ遷移
      window.location.href = "{% url 'codemon:upload_file' %}";
    });
  });

  document.querySelectorAll('.btn-image').forEach(btn => {
    btn.addEventListener('click', () => {
      // 画像投函画面へ遷移
      window.location.href = "{% url 'codemon:upload_image' %}";
    });
  });

  document.querySelectorAll('.btn-send').forEach(btn => {
    btn.addEventListener('click', () => {
      const input = document.querySelector('.message-input');
      if (input.value.trim()) {
        console.log('送信メッセージ:', input.value);
        input.value = '';
        // WebSocketで送信処理
      }
    });
  });
</script>
{% endblock %}
