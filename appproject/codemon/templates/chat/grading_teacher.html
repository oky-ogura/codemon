{% extends "base.html" %}
{% load static %}

{% block body_class %} class="no-scroll"{% endblock %}

{% block background_frame %}
  <img src="{% static 'codemon/images/frames/bg_frame_yellow.png' %}" 
       alt="" 
       class="bg-frame frame-yellow"
       onerror="this.style.display='none';">
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'codemon/css/grading.css' %}">
<style>
/* ã“ã“ã§ãƒãƒ£ãƒƒãƒˆç”»é¢ã®ã‚µã‚¤ã‚ºã¨ä½ç½®ã‚’ç›´æ¥ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã§ãã¾ã™ */
:root {
  /* ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ä¸­å¤®é…ç½®(ã‚«ãƒ¼ãƒ‰é¢¨) */
  --chat-max-width: 800px;
  --chat-max-height: 70vh;
  --chat-margin: 20px auto;
  --chat-border-radius: 12px;
  --chat-box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  --chat-position: fixed;
  --chat-position-x: 50px;
  --chat-position-y: 130px;
  --chat-margin: 0;
  */
}
</style>
{% endblock %}

{% block content %}
<div class="grading-container">
  <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
  <div class="grading-header">
    <button class="btn-back" onclick="history.back()">â†</button>
    <h1 class="grading-title">æ¡ç‚¹ç®¡ç†</h1>
  </div>

  <!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
  <div class="grading-content">
    <!-- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
    <div class="filter-section">
      <select id="box-filter" class="filter-dropdown">
        <option value="all">ã™ã¹ã¦ã®æŠ•å‡½ãƒœãƒƒã‚¯ã‚¹</option>
      </select>
      <select id="status-filter" class="filter-dropdown">
        <option value="all">ã™ã¹ã¦ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</option>
        <option value="submitted">æå‡ºæ¸ˆã¿</option>
        <option value="graded">æ¡ç‚¹æ¸ˆã¿</option>
        <option value="not-graded">æœªæ¡ç‚¹</option>
      </select>
    </div>

    <!-- æå‡ºä¸€è¦§ -->
    <div class="submissions-list">
      <!-- æå‡ºãƒ‡ãƒ¼ã‚¿ãŒã“ã“ã«å‹•çš„ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
    </div>
  </div>
      <!-- æå‡º1 -->
      <div class="submission-card not-graded">
        <div class="submission-card-header">
          <h3 class="student-name">ç”°ä¸­å¤ªéƒ</h3>
          <span class="submission-date">2026-01-20 10:30</span>
        </div>
        <div class="submission-card-body">
          <div class="assignment-info">
            <span class="assignment-name">æ•°å­¦ ç¬¬1å›èª²é¡Œ</span>
            <span class="status-badge not-graded">æœªæ¡ç‚¹</span>
          </div>
          <div class="file-list">
            <div class="file-item">
              <span class="file-icon">ğŸ“„</span>
              <span class="file-name">assignment_1.pdf</span>
              <a href="#" class="btn-download">DL</a>
            </div>
          </div>
        </div>
        <div class="submission-card-footer">
          <button class="btn-view-submission" onclick="viewSubmission(1)">è©³ç´°è¡¨ç¤º</button>
          <button class="btn-grade" onclick="openGradeForm(1)">æ¡ç‚¹ã™ã‚‹</button>
        </div>
      </div>

      <!-- æå‡º2 -->
      <div class="submission-card graded">
        <div class="submission-card-header">
          <h3 class="student-name">éˆ´æœ¨èŠ±å­</h3>
          <span class="submission-date">2026-01-18 09:15</span>
        </div>
        <div class="submission-card-body">
          <div class="assignment-info">
            <span class="assignment-name">æ•°å­¦ ç¬¬1å›èª²é¡Œ</span>
            <span class="status-badge graded">æ¡ç‚¹æ¸ˆã¿</span>
          </div>
          <div class="grade-info">
            <span class="grade-label">ç‚¹æ•°:</span>
            <span class="grade-value">92ç‚¹</span>
          </div>
          <div class="file-list">
            <div class="file-item">
              <span class="file-icon">ğŸ“„</span>
              <span class="file-name">assignment_2.pdf</span>
              <a href="#" class="btn-download">DL</a>
            </div>
          </div>
        </div>
        <div class="submission-card-footer">
          <button class="btn-view-submission" onclick="viewSubmission(2)">è©³ç´°è¡¨ç¤º</button>
          <button class="btn-edit-grade" onclick="editGrade(2)">æ¡ç‚¹ã‚’ç·¨é›†</button>
        </div>
      </div>

      <!-- æå‡º3 -->
      <div class="submission-card not-graded">
        <div class="submission-card-header">
          <h3 class="student-name">ä½è—¤æ¬¡éƒ</h3>
          <span class="submission-date">2026-01-19 14:45</span>
        </div>
        <div class="submission-card-body">
          <div class="assignment-info">
            <span class="assignment-name">è‹±èª ãƒªãƒ¼ãƒ‡ã‚£ãƒ³ã‚°èª²é¡Œ</span>
            <span class="status-badge not-graded">æœªæ¡ç‚¹</span>
          </div>
          <div class="file-list">
            <div class="file-item">
              <span class="file-icon">ğŸ“„</span>
              <span class="file-name">reading_task.docx</span>
              <a href="#" class="btn-download">DL</a>
            </div>
            <div class="file-item">
              <span class="file-icon">ğŸ–¼ï¸</span>
              <span class="file-name">notes_image.jpg</span>
              <a href="#" class="btn-download">DL</a>
            </div>
          </div>
        </div>
        <div class="submission-card-footer">
          <button class="btn-view-submission" onclick="viewSubmission(3)">è©³ç´°è¡¨ç¤º</button>
          <button class="btn-grade" onclick="openGradeForm(3)">æ¡ç‚¹ã™ã‚‹</button>
        </div>
      </div>
    </div>
  </div>

  <!-- æ¡ç‚¹ãƒ•ã‚©ãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div id="grade-modal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h2>æ¡ç‚¹ãƒ•ã‚©ãƒ¼ãƒ </h2>
        <button class="btn-close-modal">Ã—</button>
      </div>
      <div class="modal-body">
        <form id="grade-form">
          <div class="form-group">
            <label>å­¦ç”Ÿå</label>
            <input type="text" id="student-name-display" readonly>
          </div>
          <div class="form-group">
            <label>èª²é¡Œå</label>
            <input type="text" id="assignment-name-display" readonly>
          </div>
          <div class="form-group">
            <label>ç‚¹æ•° <span class="required">*</span></label>
            <div class="grade-input-group">
              <input type="number" id="grade-score" min="0" max="100" placeholder="0" required>
              <span class="grade-unit">ç‚¹</span>
            </div>
          </div>
          <div class="form-group">
            <label>è©•ä¾¡ <span class="required">*</span></label>
            <select id="grade-rating" required>
              <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
              <option value="excellent">å„ªç§€ (90-100ç‚¹)</option>
              <option value="good">è‰¯å¥½ (80-89ç‚¹)</option>
              <option value="fair">å¯ (70-79ç‚¹)</option>
              <option value="poor">ä¸å¯ (0-69ç‚¹)</option>
            </select>
          </div>
          <div class="form-group">
            <label>ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯</label>
            <textarea id="grade-feedback" placeholder="æ¡ç‚¹ç†ç”±ã‚„ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’å…¥åŠ›..."></textarea>
          </div>
          <div class="form-group checkbox">
            <input type="checkbox" id="send-to-student">
            <label for="send-to-student">å­¦ç”Ÿã«ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’é€ä¿¡</label>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn-cancel-modal">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        <button class="btn-submit-grade-modal">æ¡ç‚¹ã‚’é€ä¿¡</button>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  const gradeModal = document.querySelector('#grade-modal');
  const closeBtn = document.querySelector('.btn-close-modal');
  const cancelBtn = document.querySelector('.btn-cancel-modal');
  const submitBtn = document.querySelector('.btn-submit-grade-modal');

  closeBtn.addEventListener('click', () => {
    gradeModal.classList.add('hidden');
  });

  cancelBtn.addEventListener('click', () => {
    gradeModal.classList.add('hidden');
  });

  submitBtn.addEventListener('click', () => {
    const score = document.querySelector('#grade-score').value;
    const rating = document.querySelector('#grade-rating').value;
    const feedback = document.querySelector('#grade-feedback').value;
    const sendToStudent = document.querySelector('#send-to-student').checked;

    if (score !== '' && rating) {
      console.log('æ¡ç‚¹ã‚’é€ä¿¡:', { score, rating, feedback, sendToStudent });
      alert('æ¡ç‚¹ãŒé€ä¿¡ã•ã‚Œã¾ã—ãŸï¼');
      gradeModal.classList.add('hidden');
      document.querySelector('#grade-form').reset();
    } else {
      alert('ç‚¹æ•°ã¨è©•ä¾¡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
    }
  });

  function openGradeForm(id) {
    const card = document.querySelectorAll('.submission-card')[id - 1];
    const studentName = card.querySelector('.student-name').textContent;
    const assignmentName = card.querySelector('.assignment-name').textContent;

    document.querySelector('#student-name-display').value = studentName;
    document.querySelector('#assignment-name-display').value = assignmentName;

    gradeModal.classList.remove('hidden');
  }

  function editGrade(id) {
    console.log('æ¡ç‚¹ã‚’ç·¨é›†:', id);
    openGradeForm(id);
  }

  function viewSubmission(id) {
    console.log('æå‡ºå†…å®¹ã‚’è¡¨ç¤º:', id);
    alert('æå‡ºå†…å®¹ã®è©³ç´°è¡¨ç¤º');
  }

  // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ©Ÿèƒ½
  document.querySelector('#box-filter').addEventListener('change', () => {
    console.log('ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°å‡¦ç†');
  });

  document.querySelector('#status-filter').addEventListener('change', () => {
    console.log('ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼å‡¦ç†');
  });
</script>
{% endblock %}
