{% extends "base.html" %}
{% load static %}

{% block body_class %} class="no-scroll"{% endblock %}

{% block background_frame %}
  <img src="{% static 'codemon/images/frames/bg_frame_yellow.png' %}" 
       alt="" 
       class="bg-frame frame-yellow"
       onerror="this.style.display='none';">
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'codemon/css/icon_settings_teacher.css' %}">
<style>
/* ã“ã“ã§ãƒãƒ£ãƒƒãƒˆç”»é¢ã®ã‚µã‚¤ã‚ºã¨ä½ç½®ã‚’ç›´æ¥ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã§ãã¾ã™ */
:root {
  /* ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ä¸­å¤®é…ç½®(ã‚«ãƒ¼ãƒ‰é¢¨) */
  --chat-max-width: 800px;
  --chat-max-height: 70vh;
  --chat-margin: 20px auto;
  --chat-border-radius: 12px;
  --chat-box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  --chat-position: fixed;
  --chat-position-x: 50px;
  --chat-position-y: 130px;
  --chat-margin: 0;
  */
}
</style>
{% endblock %}

{% block content %}
<div class="icon-settings-container teacher">
  <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
  <div class="settings-header">
    <button class="btn-back" onclick="history.back()">â†</button>
    <h1 class="settings-title">ã‚¢ã‚¤ã‚³ãƒ³è¨­å®š</h1>
  </div>

  <!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
  <div class="settings-content">
    <!-- ç¾åœ¨ã®ã‚¢ã‚¤ã‚³ãƒ³è¡¨ç¤º -->
    <div class="current-icon-section">
      <h2>ç¾åœ¨ã®ã‚¢ã‚¤ã‚³ãƒ³</h2>
      <div class="current-icon-display">
        <img src="{% static 'codemon/images/avatars/default_teacher.png' %}" 
             alt="Current Avatar" 
             class="current-avatar-image">
      </div>
    </div>

    <!-- ã‚¢ã‚¤ã‚³ãƒ³é¸æŠã‚¨ãƒªã‚¢ -->
    <div class="icon-selection-section">
      <h2>ã‚¢ã‚¤ã‚³ãƒ³ã‚’é¸æŠ</h2>
      <div class="icon-grid">
        <div class="icon-item">
          <input type="radio" id="avatar-1" name="avatar" value="avatar-1" class="avatar-radio">
          <label for="avatar-1">
            <img src="{% static 'codemon/images/avatars/avatar_1.png' %}" alt="Avatar 1">
          </label>
        </div>

        <div class="icon-item">
          <input type="radio" id="avatar-2" name="avatar" value="avatar-2" class="avatar-radio">
          <label for="avatar-2">
            <img src="{% static 'codemon/images/avatars/avatar_2.png' %}" alt="Avatar 2">
          </label>
        </div>

        <div class="icon-item">
          <input type="radio" id="avatar-3" name="avatar" value="avatar-3" class="avatar-radio">
          <label for="avatar-3">
            <img src="{% static 'codemon/images/avatars/avatar_3.png' %}" alt="Avatar 3">
          </label>
        </div>

        <div class="icon-item">
          <input type="radio" id="avatar-4" name="avatar" value="avatar-4" class="avatar-radio">
          <label for="avatar-4">
            <img src="{% static 'codemon/images/avatars/avatar_4.png' %}" alt="Avatar 4">
          </label>
        </div>

        <div class="icon-item">
          <input type="radio" id="avatar-5" name="avatar" value="avatar-5" class="avatar-radio">
          <label for="avatar-5">
            <img src="{% static 'codemon/images/avatars/avatar_5.png' %}" alt="Avatar 5">
          </label>
        </div>

        <div class="icon-item">
          <input type="radio" id="avatar-6" name="avatar" value="avatar-6" class="avatar-radio">
          <label for="avatar-6">
            <img src="{% static 'codemon/images/avatars/avatar_6.png' %}" alt="Avatar 6">
          </label>
        </div>

        <div class="icon-item">
          <input type="radio" id="avatar-7" name="avatar" value="avatar-7" class="avatar-radio">
          <label for="avatar-7">
            <img src="{% static 'codemon/images/avatars/avatar_7.png' %}" alt="Avatar 7">
          </label>
        </div>

        <div class="icon-item">
          <input type="radio" id="avatar-8" name="avatar" value="avatar-8" class="avatar-radio">
          <label for="avatar-8">
            <img src="{% static 'codemon/images/avatars/avatar_8.png' %}" alt="Avatar 8">
          </label>
        </div>
      </div>
    </div>

    <!-- ã¾ãŸã¯ã€ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½ -->
    <div class="upload-section">
      <h2>ã‚«ã‚¹ã‚¿ãƒ ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</h2>
      <div class="upload-area">
        <input type="file" id="avatar-upload" class="file-input" accept="image/*">
        <label for="avatar-upload" class="upload-label">
          <span class="upload-icon">ğŸ“</span>
          <span class="upload-text">ã“ã“ã‚’ã‚¯ãƒªãƒƒã‚¯ã¾ãŸã¯ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—</span>
        </label>
      </div>
      <div class="upload-preview-area hidden">
        <img id="preview-image" src="" alt="Preview" class="preview-image">
      </div>
    </div>
  </div>

  <!-- ä¿å­˜ãƒœã‚¿ãƒ³ -->
  <div class="settings-footer">
    <button class="btn-cancel" onclick="history.back()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
    <button class="btn-save">ä¿å­˜ã™ã‚‹</button>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  // ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³é¸æŠæ™‚ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ›´æ–°
  document.querySelectorAll('.avatar-radio').forEach(radio => {
    radio.addEventListener('change', (e) => {
      const selectedImg = e.target.nextElementSibling.querySelector('img');
      document.querySelector('.current-avatar-image').src = selectedImg.src;
    });
  });

  // ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å‡¦ç†
  const fileInput = document.querySelector('#avatar-upload');
  fileInput.addEventListener('change', (e) => {
    const file = e.target.files[0];
    if (file && file.type.startsWith('image/')) {
      const reader = new FileReader();
      reader.onload = (event) => {
        const preview = document.querySelector('.upload-preview-area');
        const previewImg = document.querySelector('#preview-image');
        previewImg.src = event.target.result;
        preview.classList.remove('hidden');
        document.querySelector('.current-avatar-image').src = event.target.result;
      };
      reader.readAsDataURL(file);
    }
  });

  // ä¿å­˜å‡¦ç†
  document.querySelector('.btn-save').addEventListener('click', () => {
    const selectedAvatar = document.querySelector('input[name="avatar"]:checked');
    console.log('ã‚¢ã‚¤ã‚³ãƒ³è¨­å®šã‚’ä¿å­˜ã—ã¾ã™');
    // ãƒãƒ£ãƒƒãƒˆç”»é¢ã«æˆ»ã‚‹
    window.location.href = "{% url 'codemon:chat_teacher' %}";
  });
</script>
{% endblock %}
