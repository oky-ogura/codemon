{% extends "base.html" %}
{% load static %}

{% block body_class %} class="no-scroll"{% endblock %}

{% block background_frame %}
  <img src="{% static 'codemon/images/frames/bg_frame_yellow.png' %}" 
       alt="" 
       class="bg-frame frame-yellow"
       onerror="this.style.display='none';">
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'codemon/css/group_management.css' %}">
<style>
:root {
  --chat-max-width: 800px;
  --chat-max-height: 70vh;
  --chat-margin: 20px auto;
  --chat-border-radius: 12px;
  --chat-box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  --chat-position: fixed;
  --chat-position-x: 50px;
  --chat-position-y: 130px;
}

/* グループカードのスタイル */
.group-card {
  background: white;
  border-radius: 12px;
  padding: 20px;
  margin-bottom: 15px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  display: flex;
  justify-content: space-between;
  align-items: center;
  transition: all 0.3s ease;
}

.group-card:hover {
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  transform: translateY(-2px);
}

.group-info h3 {
  margin: 0 0 8px 0;
  color: #333;
  font-size: 18px;
}

.group-info p {
  margin: 0;
  color: #666;
  font-size: 14px;
}

.group-actions {
  display: flex;
  gap: 10px;
}

.btn-edit, .btn-delete {
  padding: 8px 16px;
  border-radius: 6px;
  text-decoration: none;
  font-size: 14px;
  transition: all 0.3s;
  border: none;
  cursor: pointer;
}

.btn-edit {
  background: #FFD700;
  color: #333;
}

.btn-edit:hover {
  background: #FFC700;
}

.btn-delete {
  background: #ff4444;
  color: white;
}

.btn-delete:hover {
  background: #cc0000;
}

.empty-state {
  text-align: center;
  padding: 60px 20px;
  color: #999;
}

.empty-state p:first-child {
  font-size: 18px;
  margin-bottom: 10px;
}

.empty-state p:last-child {
  font-size: 14px;
}
</style>
{% endblock %}

{% block content %}
<div class="group-management-container">
  <!-- ヘッダー -->
  <div class="management-header">
    <button class="btn-back" onclick="location.href='{% url 'codemon:chat_teacher' %}'">←</button>
    <h1 class="management-title">グループ管理</h1>
    <a href="{% url 'codemon:chat_messege_group_create' %}" class="btn-create-group">新規作成</a>
  </div>

  <!-- コンテンツ -->
  <div class="management-content">
    <!-- グループ一覧 -->
    <div class="groups-list">
      {% if groups %}
        {% for group in groups %}
        <div class="group-card">
          <div class="group-info">
            <h3 class="group-name">{{ group.group_name }}</h3>
            <p class="group-members">メンバー数: {{ group.memberships.count }}人</p>
          </div>
          <div class="group-actions">
            <a href="{% url 'codemon:group_edit' group.group_id %}" class="btn-edit">編集</a>
            <a href="{% url 'codemon:group_delete' group.group_id %}" class="btn-delete">削除</a>
          </div>
        </div>
        {% endfor %}
      {% else %}
        <div class="empty-state">
          <p>グループがまだありません</p>
          <p>新規作成ボタンからグループを作成してください</p>
        </div>
      {% endif %}
    </div>
  </div>
{% endblock %}

{% block extra_js %}
<script>
  const groupModal = document.querySelector('#create-group-modal');
  const membersModal = document.querySelector('#members-modal');
  const createGroupBtn = document.querySelector('.btn-create-group');

  createGroupBtn.addEventListener('click', () => {
    groupModal.classList.remove('hidden');
  });

  document.querySelectorAll('.btn-close-modal').forEach(btn => {
    btn.addEventListener('click', (e) => {
      if (e.target.closest('#create-group-modal')) {
        groupModal.classList.add('hidden');
      } else if (e.target.closest('#members-modal')) {
        membersModal.classList.add('hidden');
      }
    });
  });

  document.querySelectorAll('.btn-cancel-modal').forEach(btn => {
    btn.addEventListener('click', () => {
      groupModal.classList.add('hidden');
    });
  });

  document.querySelectorAll('.btn-close-modal-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      membersModal.classList.add('hidden');
    });
  });

  document.querySelector('.btn-submit-modal').addEventListener('click', () => {
    const name = document.querySelector('#group-name').value;
    const description = document.querySelector('#group-description').value;

    if (name) {
      console.log('グループ作成:', { name, description });
      alert('グループが作成されました！');
      groupModal.classList.add('hidden');
      document.querySelector('#create-group-form').reset();
    } else {
      alert('グループ名を入力してください');
    }
  });

  function viewMembers(id) {
    membersModal.classList.remove('hidden');
  }

  function editGroup(id) {
    console.log('グループ編集:', id);
    alert('グループの編集機能');
  }

  function deleteGroup(id) {
    if (confirm('このグループを削除してもよろしいですか？')) {
      console.log('グループ削除:', id);
      alert('グループが削除されました');
    }
  }

  function removeMember(id) {
    if (confirm('このメンバーを削除してもよろしいですか？')) {
      console.log('メンバー削除:', id);
      alert('メンバーが削除されました');
    }
  }

  document.querySelector('.btn-add-member').addEventListener('click', () => {
    const memberSelect = document.querySelector('#member-select').value;
    if (memberSelect) {
      console.log('メンバー追加:', memberSelect);
      alert('メンバーが招待されました！');
      document.querySelector('#member-select').value = '';
    } else {
      alert('メンバーを選択してください');
    }
  });
</script>
{% endblock %}
