{% extends "base.html" %}
{% load static %}

{% block body_class %} class="no-scroll"{% endblock %}

{% block background_frame %}
  <img src="{% static 'codemon/images/frames/bg_frame_yellow.png' %}" 
       alt="" 
       class="bg-frame frame-yellow"
       onerror="this.style.display='none';">
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'codemon/css/submission_box.css' %}">
<style>
/* ここでチャット画面のサイズと位置を直接カスタマイズできます */
:root {
  /* デスクトップ中央配置(カード風) */
  --chat-max-width: 800px;
  --chat-max-height: 70vh;
  --chat-margin: 20px auto;
  --chat-border-radius: 12px;
  --chat-box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  --chat-position: fixed;
  --chat-position-x: 50px;
  --chat-position-y: 130px;
  --chat-margin: 0;
  */
}
</style>
{% endblock %}

{% block content %}
<div class="submission-box-container">
  <!-- ヘッダー -->
  <div class="box-header">
    <button class="btn-back" onclick="history.back()">←</button>
    <h1 class="box-title">投函ボックス</h1>
    <button class="btn-create-box">＋ 新規作成</button>
  </div>

  <!-- コンテンツ -->
  <div class="box-content">
    <!-- 投函ボックス一覧 -->
    <div class="boxes-list">
      <!-- 投函ボックスがここに動的に表示されます -->
    </div>
  </div>

  <!-- 新規作成モーダル -->
  <div id="create-box-modal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h2>投函ボックスを作成</h2>
        <button class="btn-close-modal">×</button>
      </div>
      <div class="modal-body">
        <form id="create-box-form">
          <div class="form-group">
            <label>ボックス名</label>
            <input type="text" id="box-name" placeholder="例：数学 第1回課題" required>
          </div>
          <div class="form-group">
            <label>説明</label>
            <textarea id="box-description" placeholder="課題の説明を入力..."></textarea>
          </div>
          <div class="form-group">
            <label>期限</label>
            <input type="date" id="box-deadline" required>
          </div>
          <div class="form-group">
            <label>グループ</label>
            <select id="box-group" required>
              <option value="">選択してください</option>
              <option value="group-1">グループ：数学</option>
              <option value="group-2">グループ：英語</option>
              <option value="group-3">グループ：理科</option>
            </select>
          </div>
          <div class="form-group checkbox">
            <input type="checkbox" id="allow-multiple" checked>
            <label for="allow-multiple">複数ファイルの提出を許可</label>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn-cancel-modal">キャンセル</button>
        <button class="btn-submit-modal">作成する</button>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  const modal = document.querySelector('#create-box-modal');
  const createBtn = document.querySelector('.btn-create-box');
  const closeBtn = document.querySelector('.btn-close-modal');
  const cancelBtn = document.querySelector('.btn-cancel-modal');
  const submitBtn = document.querySelector('.btn-submit-modal');

  createBtn.addEventListener('click', () => {
    modal.classList.remove('hidden');
  });

  closeBtn.addEventListener('click', () => {
    modal.classList.add('hidden');
  });

  cancelBtn.addEventListener('click', () => {
    modal.classList.add('hidden');
  });

  submitBtn.addEventListener('click', () => {
    const form = document.querySelector('#create-box-form');
    const name = document.querySelector('#box-name').value;
    const description = document.querySelector('#box-description').value;
    const deadline = document.querySelector('#box-deadline').value;
    const group = document.querySelector('#box-group').value;

    if (name && deadline && group) {
      console.log('ボックス作成:', { name, description, deadline, group });
      alert('投函ボックスが作成されました！');
      modal.classList.add('hidden');
      form.reset();
    } else {
      alert('必須項目を入力してください');
    }
  });

  function editBox(id) {
    console.log('ボックス編集:', id);
    alert('ボックスの編集機能');
  }

  function deleteBox(id) {
    if (confirm('このボックスを削除してもよろしいですか？')) {
      console.log('ボックス削除:', id);
      alert('ボックスが削除されました');
    }
  }

  document.querySelectorAll('.btn-view-submissions').forEach(btn => {
    btn.addEventListener('click', () => {
      console.log('提出状況を確認');
      // 提出状況の詳細画面に遷移
    });
  });
</script>
{% endblock %}
