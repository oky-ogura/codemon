{% extends "base.html" %}
{% load static %}

{% block body_class %} class="no-scroll"{% endblock %}

{% block background_frame %}
  <img src="{% static 'codemon/images/frames/bg_frame_yellow.png' %}" 
       alt="" 
       class="bg-frame frame-yellow"
       onerror="this.style.display='none';">
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'codemon/css/file_upload.css' %}">
<style>
/* ã“ã“ã§ãƒãƒ£ãƒƒãƒˆç”»é¢ã®ã‚µã‚¤ã‚ºã¨ä½ç½®ã‚’ç›´æ¥ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã§ãã¾ã™ */
:root {
  /* ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ä¸­å¤®é…ç½®(ã‚«ãƒ¼ãƒ‰é¢¨) */
  --chat-max-width: 800px;
  --chat-max-height: 70vh;
  --chat-margin: 20px auto;
  --chat-border-radius: 12px;
  --chat-box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  --chat-position: fixed;
  --chat-position-x: 50px;
  --chat-position-y: 130px;
  --chat-margin: 0;
  */
}
</style>
{% endblock %}

{% block content %}
<div class="file-upload-container">
  <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
  <div class="upload-header">
    <button class="btn-back" onclick="history.back()">â†</button>
    <h1 class="upload-title">ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŠ•å‡½</h1>
  </div>

  <!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
  <div class="upload-content">
    <!-- å®›å…ˆé¸æŠ -->
    <div class="recipient-section">
      <h2>å®›å…ˆã‚’é¸æŠ</h2>
      <select id="recipient-select" class="recipient-dropdown">
        <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
        <!-- å®›å…ˆãŒã“ã“ã«å‹•çš„ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
      </select>
    </div>

    <!-- ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠã‚¨ãƒªã‚¢ -->
    <div class="file-selection-section">
      <h2>ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ</h2>
      <div class="upload-area" id="upload-area">
        <input type="file" id="file-input" class="file-input" multiple>
        <label for="file-input" class="upload-label">
          <span class="upload-icon">ğŸ“</span>
          <span class="upload-text">ã“ã“ã‚’ã‚¯ãƒªãƒƒã‚¯ã¾ãŸã¯ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—</span>
          <span class="upload-hint">å¯¾å¿œå½¢å¼: PDFã€DOCXã€XLSXã€JPGã€PNGç­‰</span>
        </label>
      </div>

      <!-- é¸æŠã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ -->
      <div class="selected-files-section">
        <h3>é¸æŠã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«</h3>
        <ul id="file-list" class="file-list">
          <!-- ãƒ•ã‚¡ã‚¤ãƒ«ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
        </ul>
      </div>
    </div>

    <!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å…¥åŠ› -->
    <div class="message-section">
      <h2>ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰</h2>
      <textarea id="message" class="message-textarea" placeholder="ãƒ•ã‚¡ã‚¤ãƒ«ã«é–¢ã™ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›..."></textarea>
    </div>
  </div>

  <!-- ãƒ•ãƒƒã‚¿ãƒ¼ -->
  <div class="upload-footer">
    <button class="btn-cancel" onclick="history.back()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
    <button class="btn-upload">æŠ•å‡½ã™ã‚‹</button>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  let selectedFiles = [];

  const uploadArea = document.querySelector('#upload-area');
  const fileInput = document.querySelector('#file-input');
  const fileList = document.querySelector('#file-list');

  // ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—å‡¦ç†
  uploadArea.addEventListener('dragover', (e) => {
    e.preventDefault();
    uploadArea.classList.add('drag-over');
  });

  uploadArea.addEventListener('dragleave', () => {
    uploadArea.classList.remove('drag-over');
  });

  uploadArea.addEventListener('drop', (e) => {
    e.preventDefault();
    uploadArea.classList.remove('drag-over');
    
    const files = Array.from(e.dataTransfer.files);
    handleFiles(files);
  });

  // ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠå‡¦ç†
  fileInput.addEventListener('change', (e) => {
    const files = Array.from(e.target.files);
    handleFiles(files);
  });

  function handleFiles(files) {
    selectedFiles = [...selectedFiles, ...files];
    updateFileList();
  }

  function updateFileList() {
    fileList.innerHTML = '';
    selectedFiles.forEach((file, index) => {
      const li = document.createElement('li');
      li.className = 'file-item';
      li.innerHTML = `
        <span class="file-name">
          <span class="file-icon">ğŸ“„</span>
          ${file.name}
        </span>
        <span class="file-size">${(file.size / 1024).toFixed(2)} KB</span>
        <button class="btn-remove-file" onclick="removeFile(${index})">Ã—</button>
      `;
      fileList.appendChild(li);
    });
  }

  function removeFile(index) {
    selectedFiles.splice(index, 1);
    updateFileList();
  }

  // æŠ•å‡½å‡¦ç†
  document.querySelector('.btn-upload').addEventListener('click', () => {
    const recipient = document.querySelector('#recipient-select').value;
    const message = document.querySelector('#message').value;

    if (!recipient) {
      alert('å®›å…ˆã‚’é¸æŠã—ã¦ãã ã•ã„');
      return;
    }

    if (selectedFiles.length === 0) {
      alert('ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„');
      return;
    }

    console.log('ãƒ•ã‚¡ã‚¤ãƒ«æŠ•å‡½:', {
      recipient: recipient,
      files: selectedFiles.map(f => f.name),
      message: message
    });

    alert('ãƒ•ã‚¡ã‚¤ãƒ«ãŒæŠ•å‡½ã•ã‚Œã¾ã—ãŸï¼');
    history.back();
  });
</script>
{% endblock %}
