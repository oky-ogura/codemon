{% extends 'base.html' %}
{% load static %}

{% block title %}ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆä½œæˆ - Codemon{% endblock %}
{% block body_class %} class="no-scroll"{% endblock %}

{% block background_frame %}
  <img src="{% static 'codemon/images/frames/bg_frame_green.png' %}" 
       alt="" 
       class="bg-frame frame-green"
       onerror="this.style.display='none';">
{% endblock %}

{% block extra_css %}
<style>
.page-hero {
  display: flex;
  justify-content: center;
  align-items: center;
  padding-top: 150px;
}
.page-hero-img {
  width: 100%;
  max-width: 300px;
  height: auto;
  display: block;
  object-fit: contain;
}

.meta-info {
  margin: 12px 0 4px;
  color: #555;
  font-size: 14px;
}

.form-actions {
  margin-top: 18px;
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 14px;
  position: relative;
  overflow: visible;
  z-index: 1000; /* selectionãƒšãƒ¼ã‚¸ã®centerã‚³ãƒ³ãƒ†ãƒŠç›¸å½“ã®å‰é¢åŒ– */
}
.btn-back,
.btn-create {
  position: relative;
  display: inline-block;
  padding: 0;
  background: none;
  border: none;
  cursor: pointer;
  overflow: visible;
  z-index: 2;
}

.btn-back img {
  width: var(--back-img-width, 100%);
  max-width: var(--back-img-max-width, 220px);
  height: var(--back-img-height, auto);
  object-fit: var(--back-img-object-fit, contain);
  border-radius: 999px;
  box-shadow: none;
  transition: transform .18s ease;
  display: block;
  position: var(--back-img-position, relative);
  transform: translate(
      var(--back-img-offset-x, var(--back-img-translate-x, -40px)),
      var(--back-img-offset-y, var(--back-img-translate-y, -45px))
    ) rotate(var(--back-img-rotate, 0deg)) scale(var(--back-img-scale, 1));
}

.btn-create img {
  width: var(--create-img-width, 100%);
  max-width: var(--create-img-max-width, 220px);
  height: var(--create-img-height, auto);
  object-fit: var(--create-img-object-fit, contain);
  border-radius: 999px;
  box-shadow: none;
  transition: transform .18s ease;
  display: block;
  position: var(--create-img-position, relative);
  transform: translate(
      var(--create-img-offset-x, var(--create-img-translate-x, 40px)),
      var(--create-img-offset-y, var(--create-img-translate-y, -45px))
    ) rotate(var(--create-img-rotate, 0deg)) scale(var(--create-img-scale, 1));
}

/* è¦ªãƒ•ã‚©ãƒ¼ãƒ ã‚³ãƒ³ãƒ†ãƒŠã§ã‚‚ã‚¯ãƒªãƒƒãƒ”ãƒ³ã‚°ã‚’é˜²æ­¢ */
.checklist-form-container {
  position: relative;
  overflow: visible;
}

/* ===== ãƒ•ã‚©ãƒ¼ãƒ è¡Œï¼ˆname/descï¼‰å…±é€š: ç”»åƒï¼‹é‡ã­é…ç½® ===== */
.form-row {
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 100%;
  max-width: min(92vw, 980px);
  margin: 0 auto 16px;
  min-height: var(--row-min-height, 220px);
  overflow: visible;
}

.form-row .row-bg {
  position: var(--row-img-position, absolute);
  width: var(--row-img-width, 100%);
  max-width: var(--row-img-max-width, 640px);
  height: var(--row-img-height, auto);
  object-fit: var(--row-img-object-fit, contain);
  display: block;
  top: var(--row-img-top, 50%);
  left: var(--row-img-left, 50%);
  transform: translate(
    var(--row-img-offset-x, -50%),
    var(--row-img-offset-y, -50%)
  ) rotate(var(--row-img-rotate, 0deg)) scale(var(--row-img-scale, 1));
  z-index: 0;
}

.form-row .form-content {
  position: absolute;
  display: flex;
  align-items: center;
  gap: var(--content-gap, 16px);
  top: var(--content-top, 50%);
  left: var(--content-left, 50%);
  transform: translate(var(--content-offset-x, -50%), var(--content-offset-y, -50%));
  z-index: 2;
  width: var(--content-width, auto);
}

.form-row .field-label {
  position: var(--label-position, relative);
  top: var(--label-top, 0);
  left: var(--label-left, 0);
  transform: translate(var(--label-offset-x, 0), var(--label-offset-y, 0)) scaleX(var(--label-scaleX, 1)) scaleY(var(--label-scaleY, 1));
  font-weight: var(--label-font-weight, 700);
  font-size: var(--label-font-size, 18px);
  color: var(--label-color, #151515);
  white-space: nowrap;
  flex-shrink: 0;
}

.form-row .field-input {
  position: var(--input-position, relative);
  top: var(--input-top, 0);
  left: var(--input-left, 0);
  transform: translate(var(--input-offset-x, 0), var(--input-offset-y, 0));
  width: var(--input-width, 420px);
}

.form-row .field-input input,
.form-row .field-input textarea {
  width: 100%;
  padding: 10px 12px;
  border: none;
  border-radius: 10px;
  font-size: 16px;
  background: transparent;
}

/* ===== name-row å€‹åˆ¥èª¿æ•´ç”¨å¤‰æ•° ===== */
.name-row {
  --row-min-height: 80px;
  --row-img-width: 100%;
  --row-img-max-width: 510px;
  --row-img-offset-x: -50%;
  --row-img-offset-y: 30%;
  --row-img-scale: 1;
  
  --content-top: 50%;
  --content-left: 50%;
  --content-offset-x: -50%;
  --content-offset-y: -50%;
  
  --label-font-size: 18px;
  --label-color: #151515;
  --label-offset-x: 0;
  --label-offset-y: 40px;
  
  --input-width: 250px;
  --input-offset-x: 50px;
  --input-offset-y: 40px;
}

/* ===== desc-row å€‹åˆ¥èª¿æ•´ç”¨å¤‰æ•° ===== */
.desc-row {
  --row-min-height: 220px;
  --row-img-width: 100%;
  --row-img-max-width: 510px;
  --row-img-offset-x: -50%;
  --row-img-offset-y: -70%;
  --row-img-scale: 1;
  
  --content-top: 50%;
  --content-left: 50%;
  --content-offset-x: -50%;
  --content-offset-y: -50%;
  
  --label-font-size: 18px;
  --label-color: #151515;
  --label-offset-x: 0;
  --label-offset-y: -20px;
  
  --input-width: 250px;
  --input-offset-x: 40px;
  --input-offset-y: -20px;
}

@media (max-width: 768px) {
  .page-hero-img { max-width: 600px; }
  .checklist-form-container form { max-width: 92vw; }
  .btn-back img { width: var(--back-img-width-tablet, 200px); }
  .btn-create img { width: var(--create-img-width-tablet, 200px); }
  .form-row.name-row, .form-row.desc-row { --row-min-height: 200px; }
}

@media (max-width: 480px) {
  .page-hero { padding-top: 24px; }
  .btn-back img { width: var(--back-img-width-mobile, 180px); }
  .btn-create img { width: var(--create-img-width-mobile, 180px); }
}
</style>
<style>
/* selection.html ã¨ã®å·®åˆ†å¸å: ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ©ãƒƒãƒ‘ã®ã‚¯ãƒªãƒƒãƒ”ãƒ³ã‚°ã‚’è§£é™¤ */
.content-wrapper { overflow: visible !important; }
</style>
{% endblock %}

{% block content %}

<!-- ğŸ”¹ ãƒ•ã‚©ãƒ¼ãƒ æœ¬ä½“ -->
<!-- ãƒšãƒ¼ã‚¸ãƒ˜ãƒƒãƒ€ãƒ¼ç”»åƒï¼šãƒ•ã‚©ãƒ¼ãƒ ã®ä¸Šã«è¡¨ç¤º -->
<div class="page-hero">
  <img src="{% static 'codemon/images/titles/checklist_create.png' %}" alt="ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆä½œæˆ" class="page-hero-img" onerror="this.style.display='none'">
</div>

<div class="checklist-form-container">

  <form method="post" id="checklist-form">
    {% csrf_token %}

    <div class="form-row form-group name-row">
      <img class="row-bg" src="{% static 'codemon/images/backgrounds/checklist_create_bg1.png' %}" alt="">
      <div class="form-content">
        <label for="name" class="field-label">ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆå <span class="required"></span></label>
        <div class="field-input">
          <input type="text" name="name" id="name" required placeholder="ä¾‹ï¼šç¬¬1å›èª²é¡Œé€²æ—ãƒã‚§ãƒƒã‚¯">
        </div>
      </div>
    </div>

    <div class="form-row form-group desc-row">
      <img class="row-bg" src="{% static 'codemon/images/backgrounds/checklist_create_bg2.png' %}" alt="">
      <div class="form-content">
        <label for="description" class="field-label">ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆæ¦‚è¦</label>
        <div class="field-input">
          <textarea name="description" id="description" rows="3" placeholder="ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã®ç›®çš„ã‚„æ¦‚è¦ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚"></textarea>
        </div>
      </div>
    </div>

    {% if checklist %}
      <div class="meta-info">
        <p><strong>ä½œæˆæ—¥ï¼š</strong>{{ checklist.created_at|date:"Y/m/d H:i" }}</p>
        <p><strong>æœ€çµ‚æ›´æ–°æ—¥ï¼š</strong>{{ checklist.updated_at|date:"Y/m/d H:i" }}</p>
      </div>
    {% endif %}

    <div class="form-actions">
      <a href="{% url 'codemon:checklist_selection' %}" class="btn-back" aria-label="æˆ»ã‚‹">
        <img src="{% static 'codemon/images/buttons/back.png' %}" alt="">
      </a>
      <button type="submit" class="btn-create" aria-label="ä½œæˆ">
        <img src="{% static 'codemon/images/buttons/create.png' %}" alt="">
      </button>
    </div>
  </form>
</div>

{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  const accountTab = document.getElementById('account-tab');
  {% if request.user.role == 'teacher' %}
    if (accountTab) accountTab.href = "{% url 'accounts:account_entry' %}";
  {% endif %}
  // Ensure chat bubble is attached to <body> so position:fixed is viewport-relative
  try {
    const chat = document.querySelector('.chat-ai-bubble');
    if (chat && chat.parentElement !== document.body) {
      document.body.appendChild(chat);
    }
  } catch(e) {
    console.error('chat bubble reposition failed', e);
  }
});
</script>
{% endblock %}
