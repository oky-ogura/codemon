{% extends 'base.html' %}
{% load static %}

{% block title %}ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆå‰Šé™¤ç¢ºèª - Codemon{% endblock %}
{% block body_class %} class="no-scroll"{% endblock %}

{% block background_frame %}
  <img src="{% static 'codemon/images/frames/bg_frame_green.png' %}" 
       alt="" class="bg-frame frame-green" onerror="this.style.display='none';">
{% endblock %}

{% block extra_css %}
<style>
/* --- å…¨ä½“ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ --- */
.content-wrapper { padding-top: 100px !important; }

/* ğŸŒŸ èƒŒæ™¯ã®ãƒªã‚¹ãƒˆã‚³ãƒ³ãƒ†ãƒŠï¼ˆæœ€åˆã¯è¦‹ãˆã¦ã„ã¦ã€ã‚ã¨ã§æ¶ˆã™ï¼‰ */
.checklist-delete-container {
    max-width: 800px; width: 90vw; margin: 0 auto; padding: 30px;
    background-color: rgba(255, 255, 255, 0.98); border-radius: 40px; 
    border: 8px solid #ffffff; box-shadow: 0 15px 50px rgba(0, 0, 0, 0.1);
    position: relative; z-index: 10; display: flex; flex-direction: column; align-items: center;
    transition: opacity 0.5s ease, transform 0.5s ease;
}

/* ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤ºæ™‚ã«èƒŒæ™¯ã‚’è–„ãæ¶ˆã™ãŸã‚ã®ã‚¯ãƒ©ã‚¹ */
.bg-fade-out {
    opacity: 0.05 !important; /* ã»ã¼è¦‹ãˆãªãã™ã‚‹ */
    filter: blur(5px);
    pointer-events: none;
}

/* ãƒ˜ãƒƒãƒ€ãƒ¼ãƒ»ãƒªã‚¹ãƒˆï¼ˆãƒ‡ã‚¶ã‚¤ãƒ³ç¶­æŒï¼‰ */
.delete-header { text-align: center; margin-bottom: 30px; }
.delete-title-badge {
    background: #ff7675; color: white; padding: 8px 25px; 
    border-radius: 50px; font-weight: 900; box-shadow: 0 5px 0 #e55a5a; display: inline-block;
}
.checklist-name-display { font-size: 28px; font-weight: 900; color: #2d3748; }

.preview-list {
    width: 100%; max-width: 500px; background: #f8fafc; 
    border-radius: 25px; padding: 20px; border: 4px dashed #cbd5e0;
}
.preview-item { display: flex; align-items: center; gap: 12px; padding: 10px; font-weight: 800; color: #4a5568; }
.preview-dot { width: 12px; height: 12px; background: #3fbcd9; border-radius: 50%; }

/* --- ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ --- */
.delete-confirm-overlay {
    position: fixed; inset: 0; background: rgba(0, 0, 0, 0.4); /* èƒŒæ™¯ã‚’å°‘ã—æ˜ã‚‹ã‚ã« */
    backdrop-filter: blur(8px); z-index: 2000;
    display: flex; align-items: center; justify-content: center;
    opacity: 0; visibility: hidden; transition: all 0.4s;
}
.delete-confirm-overlay.show { opacity: 1; visibility: visible; }

/* å‰Šé™¤ç¢ºèªã‚«ãƒ¼ãƒ‰ */
.delete-confirm-section {
    background: white; width: 90%; max-width: 450px; 
    border-radius: 40px; border: 10px solid #ff7675; padding: 40px 20px;
    text-align: center; position: relative;
    box-shadow: 0 20px 0 rgba(0,0,0,0.1);
    transform: scale(0.5) translateY(100px);
    opacity: 0;
    transform-origin: center bottom;
}

.delete-confirm-overlay.show .delete-confirm-section {
    animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
}

/* è½ä¸‹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆã•ã‚‰ã«é‡åŠ›æ„Ÿã‚’ã‚¢ãƒƒãƒ—ï¼‰ */
.dropping { 
    animation: dropDown 0.8s cubic-bezier(0.6, -0.28, 0.735, 0.045) forwards !important; 
}

@keyframes popIn {
    to { transform: scale(1) translateY(0); opacity: 1; }
}

@keyframes dropDown {
    0% { transform: translateY(0) rotate(0); opacity: 1; }
    15% { transform: translateY(-40px) rotate(-3deg); }
    100% { transform: translateY(1200px) rotate(20deg); opacity: 0; }
}

/* ãƒœã‚¿ãƒ³ãƒ‡ã‚¶ã‚¤ãƒ³ */
.btn-group { display: flex; justify-content: center; gap: 20px; margin-top: 30px; }
.btn-pop {
    padding: 15px 30px; border-radius: 50px; font-weight: 900; font-size: 18px;
    cursor: pointer; transition: all 0.2s; border: none; text-decoration: none;
    display: inline-flex; align-items: center; gap: 8px;
}
.btn-no { background: #edf2f7; color: #4a5568; box-shadow: 0 6px 0 #cbd5e0; }
.btn-delete-final { background: #ff7675; color: white; box-shadow: 0 6px 0 #e55a5a; }
.btn-pop:active { transform: translateY(3px); box-shadow: none; }
</style>
{% endblock %}

{% block content %}
<div class="checklist-delete-container" id="mainContainer">
    <div class="delete-header">
        <span class="delete-title-badge">ã•ãã˜ã‚‡ã®ç¢ºèª</span>
        <h1 class="checklist-name-display">{{ checklist.checklist_name }}</h1>
    </div>

    <div class="preview-list">
        {% for item in checklist.items.all|slice:":5" %}
        <div class="preview-item"><div class="preview-dot"></div> {{ item.item_text }}</div>
        {% endfor %}
    </div>
</div>

<div class="delete-confirm-overlay" id="deleteConfirmModal">
    <div class="delete-confirm-section" id="deleteCard">
        <img src="{% static 'codemon/images/tags/checklist_delete_confirm.png' %}" 
             alt="å‰Šé™¤ç¢ºèª" style="width: 180px; margin-bottom: 20px;">
        
        <h2 style="color: #ff7675; font-weight: 900; font-size: 24px; margin-bottom: 10px;">ã»ã‚“ã¨ã†ã«æ¶ˆã™ï¼Ÿ</h2>
        <p style="color: #4a5568; font-weight: 800;">
            æ¶ˆã—ãŸãƒªã‚¹ãƒˆã¯å…ƒã«ã‚‚ã©ã›ãªã„ã‚ˆï¼<br>å¿ƒã®ã˜ã‚…ã‚“ã³ã¯ã„ã„ã‹ãªï¼Ÿ
        </p>

        <div class="btn-group">
            <a href="{% url 'codemon:checklist_list' %}" class="btn-pop btn-no">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</a>
            <form id="actualDeleteForm" method="POST" action="{% url 'codemon:checklist_delete' pk=checklist.checklist_id %}" style="display: inline;">
                {% csrf_token %}
                <button type="submit" class="btn-pop btn-delete-final">ğŸ—‘ï¸ æ¶ˆã—ã¡ã‚ƒã†ï¼</button>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const modal = document.getElementById('deleteConfirmModal');
    const card = document.getElementById('deleteCard');
    const mainContainer = document.getElementById('mainContainer');
    const form = document.getElementById('actualDeleteForm');

    // 1. ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ï¼šèƒŒæ™¯ã‚’æ¶ˆã—ãªãŒã‚‰ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’å‡ºã™
    setTimeout(() => {
        modal.classList.add('show');
        mainContainer.classList.add('bg-fade-out'); // èƒŒæ™¯ã‚’ã»ã¼é€æ˜ã«ã™ã‚‹
    }, 150);

    // 2. å‰Šé™¤å®Ÿè¡Œæ™‚
    if (form) {
        form.addEventListener('submit', function(e) {
            e.preventDefault(); 

            // ã‚«ãƒ¼ãƒ‰ã‚’è½ä¸‹ã•ã›ã‚‹
            card.classList.add('dropping');
            
            // èƒŒæ™¯ï¼ˆã»ã¼é€æ˜ãªã‚³ãƒ³ãƒ†ãƒŠï¼‰ã‚‚ä¸€ç·’ã«ä¸‹ã«è½ã¨ã™ï¼ˆåŒæœŸã•ã›ã‚‹ï¼‰
            mainContainer.style.transition = "transform 0.8s cubic-bezier(0.6, -0.28, 0.735, 0.045)";
            mainContainer.style.transform = "translateY(1200px)";

            // ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã®æš—å¹•ã‚‚æ¶ˆã™
            setTimeout(() => {
                modal.style.opacity = '0';
            }, 200);

            // é€ä¿¡
            setTimeout(() => {
                form.submit();
            }, 800);
        });
    }
});
</script>
{% endblock %}