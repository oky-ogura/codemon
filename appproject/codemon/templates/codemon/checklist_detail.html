{% extends 'base.html' %}
{% load static %}
{% block background_frame %}

<img src="{% static 'codemon/images/frames/bg_frame_green.png' %}" 
     alt="" 
     class="bg-frame frame-green"
     onerror="this.style.display='none';">
{% endblock %}
{% block extra_css %}
<style>
/* ãƒšãƒ¼ã‚¸å›ºæœ‰ï¼šãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³å›ºå®šãƒ˜ãƒƒãƒ€åˆ†ã®ä½™ç™½ã‚’ç¢ºä¿ */
.content-wrapper { padding-top: 140px !important; }
</style>
{% endblock %}
{% block content %}

<!-- ğŸ”¹ ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆè©³ç´° -->
<div class="checklist-detail">

  <table class="checklist-info-table">
    <tr>
      <th>ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆå</th>
      <td>{{ checklist.checklist_name }}</td>
    </tr>
    <tr>
      <th>ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆæ¦‚è¦</th>
      <td>{{ checklist.checklist_description }}</td>
    </tr>
    <tr>
      <th>ä½œæˆæ—¥</th>
      <td>{{ checklist.created_at|date:"Y/m/d H:i" }}</td>
    </tr>
    <tr>
      <th>æœ€çµ‚æ›´æ–°æ—¥</th>
      <td>{{ checklist.updated_at|date:"Y/m/d H:i" }}</td>
    </tr>
  </table>

  <!-- ğŸ”¹ ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆé …ç›® -->
  <form method="POST" action="">
    {% csrf_token %}
    <table class="checklist-items-table">
      {% for item in checklist.items.all %}
      <tr>
        <td>
          <input type="checkbox" id="item_{{ item.checklist_item_id }}" 
          {% if item.is_done %}checked{% endif %}
          onchange="toggleItem({{ checklist.checklist_id }}, {{ item.checklist_item_id }}, this.checked)">
        </td>
        <td>
          <label for="item_{{ item.checklist_item_id }}" {% if item.is_done %}style="text-decoration: line-through; color: gray;"{% endif %}>
          {{ item.item_text }}
        </label>
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="2">é …ç›®ãŒã‚ã‚Šã¾ã›ã‚“</td>
      </tr>
      {% endfor %}
    </table>
  </form>

  <!-- ğŸ”¹ ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ -->
  <div class="actions">
    <a href="{% url 'codemon:checklist_list' %}" class="btn-back" aria-label="ä¸€è¦§ã«æˆ»ã‚‹">
      <img src="{% static 'codemon/images/buttons/back.png' %}" alt="æˆ»ã‚‹">
    </a>
    <a href="{% url 'codemon:checklist_edit' pk=checklist.checklist_id %}" class="btn-edit" aria-label="ç·¨é›†">
      <img src="{% static 'codemon/images/buttons/edit.png' %}" alt="ç·¨é›†">
    </a>
    <a href="{% url 'codemon:checklist_delete_confirm' pk=checklist.checklist_id %}" class="btn-delete" aria-label="å‰Šé™¤">
      <img src="{% static 'codemon/images/buttons/delete.png' %}" alt="å‰Šé™¤">
    </a>
  </div>

</div>

<!-- ğŸ”¹ ã‚¹ã‚¿ã‚¤ãƒ« -->
<style>
.checklist-detail {
  max-width: 800px;
  /* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ä¸‹ã«è¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ä¸Šãƒãƒ¼ã‚¸ãƒ³ã‚’åºƒã’ã‚‹ */
  margin: 120px auto 160px;
  padding: 20px;
  position: relative;
  z-index: 20;
  border: 1px solid #ddd;
  border-radius: 8px;
  background-color: #fafafa;
}
.checklist-info-table {
  width: 100%;
  border-collapse: collapse;
  margin-bottom: 20px;
}
.checklist-info-table th {
  width: 180px;
  background-color: #f8f8f8;
  text-align: left;
  padding: 10px;
  border-bottom: 1px solid #ddd;
}
.checklist-info-table td {
  padding: 10px;
  border-bottom: 1px solid #ddd;
  background-color: #fff;
}

/* ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆé …ç›®ãƒ†ãƒ¼ãƒ–ãƒ« */
.checklist-items-table {
  width: 100%;
  border-collapse: collapse;
  margin-bottom: 20px;
}
.checklist-items-table td {
  padding: 8px;
  vertical-align: middle;
}

/* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ */
.actions {
  display: flex;
  justify-content: center;
  gap: 10px;
  margin-top: 20px;
}
.btn-back, .btn-edit, .btn-delete { text-decoration: none; display: inline-block; }
.actions img { height: 56px; display: inline-block; }
.btn-back:hover img { opacity: 0.9; }
.btn-edit:hover img { opacity: 0.9; }
.btn-delete:hover img { opacity: 0.9; }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const accountTab = document.getElementById('account-tab');
  {% if request.user.role == 'teacher' %}
    accountTab.href = "{% url 'accounts:teacher_home' %}";
  {% endif %}
});
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i=0; i<cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

function toggleItem(checklistId, itemId, isDone) {
    fetch(`/codemon/checklists/${checklistId}/items/${itemId}/toggle/`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': getCookie('csrftoken'),
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ 'is_done': isDone })
    })
    .then(response => {
        if (!response.ok) alert('ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ');
    })
    .catch(error => alert('é€šä¿¡ã‚¨ãƒ©ãƒ¼ã§ã™'));
}
</script>

{% endblock %}
