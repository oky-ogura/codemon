{% extends 'base.html' %}
{% block content %}
<div class="navigation-tabs">
  <a href="{% url 'codemon:systems_list' %}" class="tab">システム</a>
  <a href="{% url 'codemon:algorithms_list' %}" class="tab">アルゴリズム</a>
  <a href="{% url 'codemon:checklist_list' %}" class="tab">チェックリスト</a>
  <a href="{% url 'accounts:student_home' %}" class="tab" id="account-tab">アカウント</a>
</div>

<div class="chat-ai-bubble">
  <a href="{% url 'codemon:chat' %}" class="chat-button">
    <i class="fas fa-comments"></i>
    AIチャット
  </a>
</div>

<div class="checklist-detail">
  <h1>{{ checklist.checklist_name }}</h1>
  <p class="description">{{ checklist.checklist_description }}</p>

  <div class="actions">
    <a href="{% url 'codemon:checklist_save' pk=checklist.checklist_id %}" class="btn-edit">編集する</a>
    <a href="{% url 'codemon:checklist_delete_confirm' pk=checklist.checklist_id %}" class="btn-delete">削除する</a>
    <a href="{% url 'codemon:checklist_list' %}" class="btn-back">戻る</a>
  </div>

  <h2>項目一覧</h2>
  <div class="items-list">
    {% for item in checklist.items.all %}
      <div class="item">
        <span class="item-text {% if item.is_done %}done{% endif %}">
          {{ item.item_text }}
        </span>
        <form method="post" action="{% url 'codemon:checklist_toggle_item' checklist.checklist_id item.checklist_item_id %}" class="toggle-form">
          {% csrf_token %}
          <button type="submit" class="btn-toggle">
            {% if item.is_done %}未完了に戻す{% else %}完了にする{% endif %}
          </button>
        </form>
      </div>
    {% empty %}
      <p class="no-items">項目はありません。</p>
    {% endfor %}
  </div>

  <div class="add-item">
    <h3>項目を追加</h3>
    <form method="post" class="add-form">
      {% csrf_token %}
      <input type="text" name="item_text" required placeholder="新しい項目を入力">
      <button type="submit" class="btn-add">追加</button>
    </form>
  </div>
</div>

<style>
.navigation-tabs {
  display: flex;
  margin-bottom: 20px;
}

.tab {
  padding: 10px 20px;
  margin-right: 10px;
  text-decoration: none;
  color: #333;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.chat-ai-bubble {
  position: fixed;
  bottom: 20px;
  right: 20px;
}

.chat-button {
  display: inline-flex;
  align-items: center;
  padding: 10px 15px;
  background-color: #007bff;
  color: white;
  text-decoration: none;
  border-radius: 20px;
}

.checklist-detail {
  max-width: 800px;
  margin: 20px auto;
  padding: 20px;
}

.description {
  margin-bottom: 20px;
  color: #666;
}

.actions {
  margin: 20px 0;
}

.btn-delete {
  padding: 10px 20px;
  background-color: #dc3545;
  color: white;
  text-decoration: none;
  border-radius: 4px;
  display: inline-block;
}

.btn-edit {
  padding: 10px 20px;
  background-color: #28a745;
  color: white;
  text-decoration: none;
  border-radius: 4px;
  display: inline-block;
  margin-right: 10px;
}

.btn-back {
  padding: 10px 20px;
  background-color: #6c757d;
  color: white;
  text-decoration: none;
  border-radius: 4px;
  display: inline-block;
  margin-left: 10px;
}

.items-list {
  margin: 20px 0;
}

.item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px;
  border-bottom: 1px solid #eee;
}

.item-text {
  flex: 1;
}

.item-text.done {
  text-decoration: line-through;
  color: #666;
}

.toggle-form {
  margin-left: 10px;
}

.btn-toggle {
  padding: 5px 10px;
  background-color: #6c757d;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

.add-item {
  margin-top: 30px;
}

.add-form {
  display: flex;
  gap: 10px;
}

.add-form input[type="text"] {
  flex: 1;
  padding: 8px;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.btn-add {
  padding: 8px 16px;
  background-color: #28a745;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

.no-items {
  color: #666;
  font-style: italic;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const accountTab = document.getElementById('account-tab');
  
  // アカウントタブのリンクをユーザーロールに基づいて更新
  {% if request.user.role == 'teacher' %}
    accountTab.href = "{% url 'accounts:teacher_home' %}";
  {% endif %}
});
</script>
{% endblock %}
