{% extends 'base.html' %}
{% load static %}

{% block title %}チェックリスト一覧 - Codemon{% endblock %}
{% block body_class %} class="no-scroll"{% endblock %}

{% block background_frame %}
  <img src="{% static 'codemon/images/frames/bg_frame_green.png' %}" 
       alt="" 
       class="bg-frame frame-green"
       onerror="this.style.display='none';">
{% endblock %}

{% block extra_css %}
<style>
/* ページ固有：ナビゲーションの高さ分だけコンテンツを下げる */
.content-wrapper { padding-top: 140px !important; }

/* ページヘッダー用画像 */
.page-hero { text-align: center; margin-bottom: 6px; }
.page-hero h1 { font-size: 44px; margin: 8px 0 18px; font-weight:800; }
.page-hero-img { display:block; margin: 0 auto 12px; }

/* コンテナ */
.checklist-list-container { max-width: 1100px; width: min(94vw,1100px); margin: 80px auto 120px; padding: 30px 36px; position: relative; z-index:20; background-color:#f9f9f9; border:1px solid #eee; border-radius:12px; }
.checklist-list-container h1 { text-align: center; margin-bottom: 8px; font-size:28px; }

/* テーブル（カード風の行に置き換え） */
.checklist-table { width: 100%; margin-top: 10px; }
.checklist-row { display:flex; align-items:center; background:rgba(255,255,255,0.95); border-radius:28px; padding:14px 18px; margin:12px 0; }
.checklist-row.header { background:transparent; box-shadow:none; border-radius:4px; padding:8px 6px; margin-top:0; }
.checklist-cell { padding: 8px 12px; }
.checklist-name { flex:1; display:flex; align-items:center; gap:12px; font-weight:700; }
.checklist-meta { width:180px; text-align:center; color:#444; }
.checklist-updated { width:200px; text-align:center; color:#444; }
.checklist-action { width:240px; text-align:center; }
.checklist-action .btn-view { display:inline-block; }
.no-items { text-align: center; color: #999; font-style: italic; padding: 40px 0 !important; }

/* 閲覧ボタン（緑の丸角） */
.btn-view { display:inline-block; background:#bfead8; color:#064; padding:10px 18px; border-radius:20px; text-decoration:none; font-weight:700; }
.btn-view:hover { filter:brightness(0.96); }

@media (max-width:800px) {
  .checklist-meta, .checklist-updated, .checklist-action { width:auto; text-align:left; }
  .checklist-row { flex-direction:column; align-items:stretch; gap:8px; }
}

/* アクション（右上）: 作成ボタンなど */
.list-actions { position: absolute; right: 22px; top: 22px; display:flex; gap:12px; align-items:center; }
.list-actions a, .list-actions button { background:none; border:none; padding:0; cursor:pointer; }
.list-actions img { height:56px; display:block; }

@media (max-width: 800px) {
  .checklist-list-container { margin: 80px 12px; }
  .list-actions img { height:44px; }
}

</style>
{% endblock %}

{% block content %}

<!-- ページヘッダー画像 -->

<div class="checklist-list-container">
  <h1>チェックリスト一覧</h1>

  <div class="checklist-table">
    <div class="checklist-row header">
      <div class="checklist-cell" style="flex:1; text-align:center;">チェックリスト名</div>
      <div class="checklist-cell checklist-meta">作成日</div>
      <div class="checklist-cell checklist-updated">最終更新日</div>
      <div class="checklist-cell checklist-action">操作</div>
    </div>

    {% for checklist in checklists %}
      <div class="checklist-row">
        <div class="checklist-cell checklist-name">
          <span style="display:inline-block; width:40px; height:40px; border-radius:50%; background:#e6f7f3;"></span>
          <span>{{ checklist.checklist_name }}</span>
        </div>
        <div class="checklist-cell checklist-meta">{{ checklist.created_at|date:"Y/m/d H:i" }}</div>
        <div class="checklist-cell checklist-updated">{{ checklist.updated_at|date:"Y/m/d H:i" }}</div>
        <div class="checklist-cell checklist-action">
            <a href="{% url 'codemon:checklist_detail' pk=checklist.checklist_id %}" class="btn-view" aria-label="チェックリスト閲覧">チェックリスト閲覧</a>
        </div>
      </div>
    {% empty %}
      <div class="checklist-row"><div class="checklist-cell no-items" style="flex:1; text-align:center;">作成されたチェックリストはありません。</div></div>
    {% endfor %}
  </div>

  <!-- 戻るボタン（下部） -->
  <div class="back-button-container" style="text-align:left; margin-top:20px;">
    <a href="{% url 'codemon:checklist_selection' %}" class="btn-back">
      <img src="{% static 'codemon/images/buttons/back.png' %}" alt="戻る" style="height:56px;">
    </a>
  </div>

</div>

{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  const accountTab = document.getElementById('account-tab');
  {% if request.user.role == 'teacher' %}
    if (accountTab) accountTab.href = "{% url 'accounts:account_entry' %}";
  {% endif %}
  // Ensure chat bubble is attached to <body> so position:fixed is viewport-relative
  try {
    const chat = document.querySelector('.chat-ai-bubble');
    if (chat && chat.parentElement !== document.body) {
      document.body.appendChild(chat);
    }
  } catch(e) {
    console.error('chat bubble reposition failed', e);
  }
});
</script>
{% endblock %}
